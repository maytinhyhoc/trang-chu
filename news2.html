<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Công Cụ Y Học - NEWS2</title>
<link rel="icon" href="https://raw.githubusercontent.com/maytinhyhoc/trang-chu/main/logo.png" type="image/png">
<link rel="apple-touch-icon" href="https://raw.githubusercontent.com/maytinhyhoc/trang-chu/main/logo.png">
<link rel="manifest" href="manifest.json">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
<style>
body { font-family: 'Inter', sans-serif; background-color: #f8fafc; padding-top: 80px; }
@media (max-width: 767px) { body { padding-top: 0px; padding-bottom: 80px; } }
.nav-item-highlight { background-color: #eef2ff; border-radius: 9999px; padding: 4px 12px; color: #4f46e5; font-weight: 500; }
.bottom-nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 8px 4px; color: #6b7280; transition: color 0.2s; }
.bottom-nav-item.active { color: #4f46e5; }
.bottom-nav-item svg { width: 24px; height: 24px; margin-bottom: 2px; }
.bottom-nav-item span { font-size: 10px; font-weight: 500; }
.score-box { background-color: #eef2ff; color: #4f46e5; padding: 1rem 2rem; border-radius: 0.75rem; font-size: 2.5rem; font-weight: bold; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); text-align: center; border: 1px solid #c7d2fe; }
.result-text { font-size: 1.125rem; font-weight: 600; }
input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
input[type="number"] { -moz-appearance: textfield; }
/* Animation cho Modal */
.modal-enter { opacity: 0; transform: scale(0.9); }
.modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 0.3s, transform 0.3s; }
.modal-exit { opacity: 1; transform: scale(1); }
.modal-exit-active { opacity: 0; transform: scale(0.9); transition: opacity 0.3s, transform 0.3s; }

/* Custom Radio Button Style */
.custom-radio:checked + label {
    background-color: #e0e7ff;
    border-color: #4f46e5;
    color: #4f46e5;
}
</style>
</head>
<body class="text-gray-800 flex flex-col min-h-screen">
<!-- HEADER DESKTOP -->
<header class="hidden md:block bg-white shadow-sm py-3 fixed top-0 w-full z-50">
    <div class="container mx-auto px-4 header-content flex items-center justify-between">
        <div class="flex items-center flex-shrink-0 w-auto">
            <a href="index.html" class="logo-text text-3xl font-bold text-indigo-700 rounded-lg transition duration-300 hover:text-indigo-900">Máy tính y học</a>
        </div>
        <nav class="nav-menu flex space-x-4">
            <a href="index.html" class="flex-shrink-0 text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 px-3 py-1 rounded-full hover:bg-gray-100">Trang Chủ</a>
            <a href="cong-cu.html" class="flex-shrink-0 text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 nav-item-highlight">Công Cụ</a>
            <a href="gioi-thieu.html" class="flex-shrink-0 text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 px-3 py-1 rounded-full hover:bg-gray-100">Giới thiệu</a>
            <a href="#lien-he" class="flex-shrink-0 text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 px-3 py-1 rounded-full hover:bg-gray-100">Liên Hệ</a>
        </nav>
    </div>
</header>

<main class="flex-grow container mx-auto px-4 py-4 md:py-8">
    <div class="flex items-center justify-between mb-4 md:mb-6 pt-4 md:pt-0">
        <a href="cong-cu.html" class="flex-shrink-0 inline-flex items-center justify-center w-10 h-10 bg-white border border-gray-200 rounded-full text-indigo-600 hover:bg-indigo-50 hover:border-indigo-200 transition duration-300 shadow-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        </a>
        <h1 class="text-xl md:text-3xl font-bold text-center text-gray-800 flex-grow px-2">
            Thang điểm NEWS2
        </h1>
        <div class="w-10 h-10 flex-shrink-0"></div>
    </div>

    <div class="mt-2 md:mt-8 bg-white rounded-lg shadow-lg p-3 md:p-8 max-w-4xl mx-auto">
        <div class="bg-gray-50 p-4 sm:p-6 md:p-8 rounded-xl border border-gray-100">
            
            <p class="text-sm text-gray-500 mb-6 italic text-center">National Early Warning Score 2 - Đánh giá cảnh báo sớm mức độ bệnh nặng.</p>

            <!-- Form có novalidate để tắt bong bóng mặc định -->
            <form id="tool-form" class="space-y-8" novalidate>
                
                <!-- 1. Nhịp thở -->
                <div>
                    <label for="rr" class="block text-sm font-semibold text-gray-700 mb-2">Nhịp thở (lần/phút)</label>
                    <input type="number" id="rr" name="rr" placeholder="VD: 18" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm outline-none" inputmode="numeric">
                </div>

                <!-- 2. SpO2 -->
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                    <div class="flex items-center justify-between mb-2">
                        <label for="spo2" class="block text-sm font-semibold text-gray-700">SpO2 (%)</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="copd" name="copd" class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                            <label for="copd" class="ml-2 text-xs font-medium text-red-600 cursor-pointer select-none">Bệnh nhân COPD (Thang 2)</label>
                        </div>
                    </div>
                    <input type="number" id="spo2" name="spo2" placeholder="VD: 96" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm outline-none" inputmode="numeric">
                    <p id="scale-hint" class="text-xs text-gray-400 mt-1">Sử dụng Thang 1 (Mặc định)</p>
                </div>

                <!-- 3. Thở Oxy -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Hỗ trợ Oxy?</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <input type="radio" id="air" name="oxygen" value="air" class="hidden custom-radio">
                            <label for="air" class="block w-full text-center px-4 py-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition">Không khí phòng</label>
                        </div>
                        <div>
                            <input type="radio" id="o2" name="oxygen" value="o2" class="hidden custom-radio">
                            <label for="o2" class="block w-full text-center px-4 py-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition">Có thở Oxy</label>
                        </div>
                    </div>
                </div>

                <!-- 4. Huyết áp tâm thu -->
                <div>
                    <label for="sys_bp" class="block text-sm font-semibold text-gray-700 mb-2">Huyết áp tâm thu (mmHg)</label>
                    <input type="number" id="sys_bp" name="sys_bp" placeholder="VD: 120" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm outline-none" inputmode="numeric">
                </div>

                <!-- 5. Mạch -->
                <div>
                    <label for="pulse" class="block text-sm font-semibold text-gray-700 mb-2">Mạch (lần/phút)</label>
                    <input type="number" id="pulse" name="pulse" placeholder="VD: 80" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm outline-none" inputmode="numeric">
                </div>

                <!-- 6. Tri giác -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tri giác (AVPU)</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <input type="radio" id="alert" name="avpu" value="alert" class="hidden custom-radio">
                            <label for="alert" class="block w-full text-center px-4 py-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition">Tỉnh táo (Alert)</label>
                        </div>
                        <div>
                            <input type="radio" id="cvpu" name="avpu" value="cvpu" class="hidden custom-radio">
                            <label for="cvpu" class="block w-full text-center px-4 py-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition">C / V / P / U</label>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1 ml-1">C: Mới lú lẫn, V: Đáp ứng lời nói, P: Đáp ứng đau, U: Không đáp ứng</p>
                </div>

                <!-- 7. Nhiệt độ -->
                <div>
                    <label for="temp" class="block text-sm font-semibold text-gray-700 mb-2">Nhiệt độ (°C)</label>
                    <input type="number" id="temp" name="temp" placeholder="VD: 37.0" step="0.1" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm outline-none" inputmode="decimal">
                </div>
                
                <div class="mt-8 flex flex-col sm:flex-row gap-4">
                    <button type="submit" class="flex-1 bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-0.5 hover:bg-indigo-700 flex items-center justify-center">
                        <i class="fa-solid fa-calculator mr-2"></i> Tính toán
                    </button>
                    <button type="button" id="clearBtn" class="flex-1 bg-white text-red-500 border border-red-200 font-bold py-3 px-6 rounded-lg shadow-sm hover:shadow-md transition duration-300 hover:bg-red-50 flex items-center justify-center">
                        <i class="fa-solid fa-trash-can mr-2"></i> Xóa Dữ Liệu
                    </button>
                </div>
            </form>

            <div id="result-container" class="mt-8 hidden animate-fade-in-up">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-6 text-center shadow-inner">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-3">Điểm NEWS2</h3>
                    <div id="main-result" class="score-box mb-4 bg-white text-5xl text-indigo-700">--</div>
                    
                    <div id="risk-badge" class="inline-block px-4 py-1 rounded-full text-sm font-bold mb-4 bg-gray-200 text-gray-700">
                        Chưa đánh giá
                    </div>

                    <p id="sub-result" class="result-text text-indigo-700 leading-relaxed text-left border-t border-indigo-200 pt-4 mt-2 text-sm">
                        ...
                    </p>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- CUSTOM MODAL -->
<div id="notification-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div class="absolute inset-0 bg-black opacity-50 transition-opacity"></div>
    <div class="bg-white rounded-lg shadow-xl p-6 relative z-10 w-11/12 max-w-sm text-center transform transition-all scale-100">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
            <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
        </div>
        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-2">Thông báo</h3>
        <p id="modal-message" class="text-sm text-gray-500 mb-6">Vui lòng chọn đủ mục.</p>
        <button id="close-modal-btn" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:text-sm">
            Đóng
        </button>
    </div>
</div>

<footer id="lien-he" class="bg-gray-800 text-white py-8 text-center rounded-t-lg shadow-inner mt-auto">
    <div class="container mx-auto px-4">
        <p>&copy; 2025 Máy tính y học. Mọi quyền được bảo lưu.</p>
        <p class="mt-2">Liên hệ: BS. Nguyễn Duy Toàn - Bệnh viện đa khoa Lâm Đồng</p>
        <p>Email: <a href="mailto:toannguyen284@gmail.com" class="text-indigo-400 hover:text-white transition duration-300">toannguyen284@gmail.com</a></p>
        <div class="flex justify-center space-x-4 mt-4">
            <a href="#" class="text-gray-400 hover:text-white transition duration-300">Chính sách bảo mật</a>
            <a href="#" class="text-gray-400 hover:text-white transition duration-300">Điều khoản dịch vụ</a>
        </div>
    </div>
</footer>

<nav class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 shadow-[0_-2px_10px_rgba(0,0,0,0.1)] z-50 flex justify-around py-2 pb-safe md:hidden">
    <a href="index.html" class="bottom-nav-item"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg><span>Trang Chủ</span></a>
    <a href="cong-cu.html" class="bottom-nav-item active"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg><span>Công Cụ</span></a>
    <a href="gioi-thieu.html" class="bottom-nav-item"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" /></svg><span>Giới thiệu</span></a>
    <a href="#lien-he" class="bottom-nav-item"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" /></svg><span>Liên Hệ</span></a>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- LAYOUT ADJUSTMENT (KHÔNG ĐƯỢC XOÁ) ---
        const header = document.querySelector('header');
        const body = document.body;
        function adjustBodyPadding() {
            if (header && getComputedStyle(header).display !== 'none') {
                body.style.paddingTop = header.offsetHeight + 'px';
            } else { body.style.paddingTop = '0px'; }
        }
        adjustBodyPadding();
        window.addEventListener('resize', adjustBodyPadding);

        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('dblclick', () => { input.value = ''; });
        });

        // --- MODAL LOGIC (GIỮ NGUYÊN) ---
        const modal = document.getElementById('notification-modal');
        const modalMessage = document.getElementById('modal-message');
        const closeModalBtn = document.getElementById('close-modal-btn');

        window.showModal = function(message) {
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
        }

        function hideModal() {
            modal.classList.add('hidden');
        }

        closeModalBtn.addEventListener('click', hideModal);
        modal.addEventListener('click', function(e) {
            if (e.target === modal.querySelector('.absolute')) {
                hideModal();
            }
        });

        // --- NEWS2 LOGIC ---
        const form = document.getElementById('tool-form');
        const resultContainer = document.getElementById('result-container');
        const mainResult = document.getElementById('main-result');
        const subResult = document.getElementById('sub-result');
        const riskBadge = document.getElementById('risk-badge');
        const clearBtn = document.getElementById('clearBtn');
        const copdCheckbox = document.getElementById('copd');
        const scaleHint = document.getElementById('scale-hint');

        // Toggle UI text when COPD is checked
        copdCheckbox.addEventListener('change', function() {
            if (this.checked) {
                scaleHint.textContent = "Đang sử dụng Thang 2 (Dành cho Suy hô hấp tăng carbonic)";
                scaleHint.classList.add("text-red-500", "font-medium");
                scaleHint.classList.remove("text-gray-400");
            } else {
                scaleHint.textContent = "Sử dụng Thang 1 (Mặc định)";
                scaleHint.classList.remove("text-red-500", "font-medium");
                scaleHint.classList.add("text-gray-400");
            }
        });

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 1. Get Values
            const rr = document.getElementById('rr').value;
            const spo2 = document.getElementById('spo2').value;
            const isCOPD = document.getElementById('copd').checked;
            const oxygenRadio = document.querySelector('input[name="oxygen"]:checked');
            const sys_bp = document.getElementById('sys_bp').value;
            const pulse = document.getElementById('pulse').value;
            const avpuRadio = document.querySelector('input[name="avpu"]:checked');
            const temp = document.getElementById('temp').value;

            // 2. Validation
            if (rr === '' || spo2 === '' || !oxygenRadio || sys_bp === '' || pulse === '' || !avpuRadio || temp === '') {
                showModal("Vui lòng nhập đầy đủ các chỉ số sinh hiệu.");
                return;
            }

            const rrVal = parseFloat(rr);
            const spo2Val = parseFloat(spo2);
            const sysBpVal = parseFloat(sys_bp);
            const pulseVal = parseFloat(pulse);
            const tempVal = parseFloat(temp);
            const oxygenVal = oxygenRadio.value; // 'air' or 'o2'
            const avpuVal = avpuRadio.value; // 'alert' or 'cvpu'

            // Logic Validation (basic sanity check)
            if (rrVal < 0 || spo2Val < 0 || spo2Val > 100 || sysBpVal < 0 || pulseVal < 0 || tempVal < 10 || tempVal > 50) {
                 showModal("Một số chỉ số không hợp lệ (nằm ngoài giới hạn sinh lý). Vui lòng kiểm tra lại.");
                 return;
            }

            // 3. Calculation
            let score = 0;
            let redScore = false; // Flag for any single parameter scoring 3

            // Helper to add score and check red flag
            function addScore(points) {
                score += points;
                if (points === 3) redScore = true;
            }

            // RR
            if (rrVal <= 8) addScore(3);
            else if (rrVal >= 9 && rrVal <= 11) addScore(1);
            else if (rrVal >= 12 && rrVal <= 20) addScore(0);
            else if (rrVal >= 21 && rrVal <= 24) addScore(2);
            else if (rrVal >= 25) addScore(3);

            // SpO2
            if (!isCOPD) {
                // Scale 1
                if (spo2Val <= 91) addScore(3);
                else if (spo2Val >= 92 && spo2Val <= 93) addScore(2);
                else if (spo2Val >= 94 && spo2Val <= 95) addScore(1);
                else addScore(0);
            } else {
                // Scale 2 (Hypercapnic)
                if (spo2Val <= 83) addScore(3);
                else if (spo2Val >= 84 && spo2Val <= 87) addScore(2);
                else if (spo2Val >= 88 && spo2Val <= 92) addScore(0);
                else if (spo2Val >= 93 && spo2Val <= 94) {
                    if (oxygenVal === 'o2') addScore(1); else addScore(0);
                }
                else if (spo2Val >= 95 && spo2Val <= 96) {
                     if (oxygenVal === 'o2') addScore(2); else addScore(0);
                }
                else if (spo2Val >= 97) {
                    if (oxygenVal === 'o2') addScore(3); else addScore(0);
                }
            }

            // Air or Oxygen
            if (oxygenVal === 'o2') addScore(2);
            else addScore(0);

            // Systolic BP
            if (sysBpVal <= 90) addScore(3);
            else if (sysBpVal >= 91 && sysBpVal <= 100) addScore(2);
            else if (sysBpVal >= 101 && sysBpVal <= 110) addScore(1);
            else if (sysBpVal >= 111 && sysBpVal <= 219) addScore(0);
            else if (sysBpVal >= 220) addScore(3);

            // Pulse
            if (pulseVal <= 40) addScore(3);
            else if (pulseVal >= 41 && pulseVal <= 50) addScore(1);
            else if (pulseVal >= 51 && pulseVal <= 90) addScore(0);
            else if (pulseVal >= 91 && pulseVal <= 110) addScore(1);
            else if (pulseVal >= 111 && pulseVal <= 130) addScore(2);
            else if (pulseVal >= 131) addScore(3);

            // Consciousness
            if (avpuVal === 'alert') addScore(0);
            else addScore(3); // CVPU

            // Temperature
            if (tempVal <= 35.0) addScore(3);
            else if (tempVal >= 35.1 && tempVal <= 36.0) addScore(1);
            else if (tempVal >= 36.1 && tempVal <= 38.0) addScore(0);
            else if (tempVal >= 38.1 && tempVal <= 39.0) addScore(1);
            else if (tempVal >= 39.1) addScore(2);

            // 4. Result Interpretation
            mainResult.textContent = score;
            
            let riskLevel = "";
            let riskClass = "";
            let message = "";

            if (score >= 0 && score <= 4 && !redScore) {
                riskLevel = "Nguy cơ THẤP";
                riskClass = "bg-green-100 text-green-800";
                message = "Theo dõi lâm sàng dựa trên năng lực điều dưỡng.";
            } else if ((score >= 0 && score <= 4 && redScore) || score === 3) {
                 // Note: Logic specifies score of 3 in ANY single parameter means Low-Medium
                 // But strictly 0-4 is low, unless a single param is 3.
                 // If score is 3 (total) and redScore is true, it implies the only points come from one param.
                 // If score is 4 and redScore is true, it is also Low-Medium.
                riskLevel = "Nguy cơ THẤP - TRUNG BÌNH";
                riskClass = "bg-yellow-100 text-yellow-800";
                message = "Cần phản hồi khẩn cấp từ điều dưỡng chăm sóc hoặc bác sĩ. Có một chỉ số đạt 3 điểm.";
            } else if (score >= 5 && score <= 6) {
                riskLevel = "Nguy cơ TRUNG BÌNH";
                riskClass = "bg-orange-100 text-orange-800";
                message = "Ngưỡng quan trọng. Cần phản hồi khẩn cấp từ bác sĩ lâm sàng hoặc đội cấp cứu.";
            } else if (score >= 7) {
                riskLevel = "Nguy cơ CAO";
                riskClass = "bg-red-100 text-red-800";
                message = "Cần phản hồi khẩn cấp hoặc cấp cứu. Chuyển ICU hoặc đội phản ứng nhanh.";
            }

            // Adjust simplified logic for display based strictly on RCP generic chart colors
            if (score >= 7) {
                 riskLevel = "Nguy cơ CAO";
                 riskClass = "bg-red-100 text-red-800";
            } else if (score >= 5) {
                 riskLevel = "Nguy cơ TRUNG BÌNH";
                 riskClass = "bg-orange-100 text-orange-800";
            } else if (redScore) {
                 riskLevel = "Nguy cơ THẤP - TRUNG BÌNH";
                 riskClass = "bg-yellow-100 text-yellow-800";
            } else {
                 riskLevel = "Nguy cơ THẤP";
                 riskClass = "bg-green-100 text-green-800";
            }

            riskBadge.className = `inline-block px-4 py-1 rounded-full text-sm font-bold mb-4 ${riskClass}`;
            riskBadge.textContent = riskLevel;
            subResult.innerHTML = `<strong>Khuyến nghị:</strong> ${message}`;

            resultContainer.classList.remove('hidden');
            
            // Auto Scroll
            const headerHeight = document.querySelector('header')?.offsetHeight || 0;
            const targetPos = resultContainer.getBoundingClientRect().top + window.pageYOffset - headerHeight - 20;
            window.scrollTo({ top: targetPos, behavior: 'smooth' });
        });

        clearBtn.addEventListener('click', function() {
            form.reset();
            resultContainer.classList.add('hidden');
            mainResult.textContent = "--";
            riskBadge.className = "inline-block px-4 py-1 rounded-full text-sm font-bold mb-4 bg-gray-200 text-gray-700";
            riskBadge.textContent = "Chưa đánh giá";
            scaleHint.textContent = "Sử dụng Thang 1 (Mặc định)";
            scaleHint.classList.remove("text-red-500", "font-medium");
            scaleHint.classList.add("text-gray-400");
        });
    });
</script>
</body>
</html>