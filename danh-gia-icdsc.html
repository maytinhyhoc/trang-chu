<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thang điểm ICDSC (Sàng lọc Mê sảng ICU) - Công Cụ Y Học</title>
    <link rel="icon" href="https://raw.githubusercontent.com/maytinhyhoc/trang-chu/main/logo.png" type="image/png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="settings.js"></script>
    <script src="protection.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            padding-bottom: 70px;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: pan-y;
        }

        .toggle-checkbox:checked {
            right: 0;
            border-color: #ef4444;
        }

        .toggle-checkbox:checked+.toggle-label {
            background-color: #ef4444;
        }
    </style>
</head>

<body class="text-gray-800 flex flex-col min-h-screen">

    <!-- Mobile Header -->
    <header
        class="md:hidden fixed top-0 left-0 right-0 bg-white dark:bg-slate-900 shadow-sm z-40 h-[60px] flex items-center justify-center px-4 transition-colors duration-300">
        <h1 class="text-center text-lg font-bold text-gray-800 dark:text-white truncate px-2">
            Thang điểm ICDSC (Mê sảng)
        </h1>
    </header>

    <main class="flex-grow container mx-auto px-2 md:px-4 pt-20 md:pt-24 pb-2 max-w-2xl">
        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-red-100 dark:border-slate-700 overflow-hidden">
            <div class="bg-red-600 p-4 text-white">
                <h1 class="text-xl font-bold"><i class="fa-solid fa-brain mr-2"></i>ICDSC (Sàng lọc Delirium)</h1>
                <p class="text-red-100 text-sm mt-1">Intensive Care Delirium Screening Checklist</p>
            </div>

            <div class="p-6 space-y-6">

                <div
                    class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-lg border border-yellow-100 dark:border-yellow-900/30 text-sm text-yellow-800 dark:text-yellow-200 mb-4">
                    <i class="fa-solid fa-triangle-exclamation mr-1"></i>
                    <strong>Lưu ý:</strong> Chỉ đánh giá khi bệnh nhân đáp ứng kích thích (RASS >= -3). Nếu hôn mê sâu,
                    không đánh giá.
                </div>

                <!-- Checklist Items -->
                <div class="space-y-3" id="checklist">
                    <!-- JS Injected -->
                </div>

                <!-- Result -->
                <div
                    class="bg-gray-100 dark:bg-slate-700/50 p-4 rounded-lg flex justify-between items-center border-t border-gray-200 dark:border-slate-600">
                    <div>
                        <span class="text-sm font-semibold uppercase text-gray-500 dark:text-gray-400">Tổng điểm</span>
                        <div class="text-3xl font-bold text-red-600 dark:text-red-400" id="total-score">0</div>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-semibold uppercase text-gray-500 dark:text-gray-400">Kết quả</span>
                        <div class="text-xl font-bold text-gray-800 dark:text-white" id="result-text">Bình thường</div>
                    </div>
                </div>

                <!-- Reset Button -->
                <div class="flex justify-center mt-4">
                    <button onclick="resetTool()"
                        class="px-6 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-500 rounded-full shadow-sm text-gray-600 dark:text-gray-300 font-bold text-sm hover:bg-gray-100 dark:hover:bg-slate-600 transition-all">
                        <i class="fa-solid fa-rotate-right mr-2"></i> Nhập lại
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initApp } from './app.js';

        const items = [
            { id: 1, text: 'Thay đổi mức độ ý thức', sub: 'Nếu có tăng động hoặc ngủ gà (RASS != 0) -> 1 điểm' },
            { id: 2, text: 'Giảm sự chú ý (Inattention)', sub: 'Khó tập trung nghe lệnh hoắc làm theo y lệnh' },
            { id: 3, text: 'Mất định hướng (Disorientation)', sub: 'Về thời gian, không gian hoặc bản thân' },
            { id: 4, text: 'Ảo giác / Hoang tưởng / Loạn thần', sub: 'Nhìn/nghe thấy những thứ không có thật' },
            { id: 5, text: 'Kích động hoặc Chậm chạp tâm thần vận động', sub: 'Cần dùng thuốc an thần hoặc dây cố định / hoặc lờ đờ' },
            { id: 6, text: 'Ngôn ngữ hoặc Khí sắc không phù hợp', sub: 'Nói nhảm, la hét, cảm xúc không phù hợp hoàn cảnh' },
            { id: 7, text: 'Rối loạn chu kỳ Ngủ/Thức', sub: 'Ngủ ngày thức đêm hoặc thức liên tục < 4h/đêm' },
            { id: 8, text: 'Triệu chứng dao động', sub: 'Các biểu hiện trên thay đổi theo giờ/trong ngày' }
        ];

        function render() {
            const container = document.getElementById('checklist');
            container.innerHTML = items.map(item => `
                <div class="flex items-start justify-between p-3 bg-gray-50 dark:bg-slate-700/30 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors cursor-pointer" onclick="toggle('${item.id}')">
                    <div class="mr-4">
                        <h3 class="font-bold text-gray-800 dark:text-gray-200 text-sm">${item.id}. ${item.text}</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${item.sub}</p>
                    </div>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="toggle" id="check-${item.id}" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300 dark:border-slate-500 transition-all duration-300 top-0 left-0"/>
                        <label for="check-${item.id}" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 dark:bg-slate-600 cursor-pointer transition-colors duration-300"></label>
                    </div>
                </div>
            `).join('');
        }

        window.toggle = function (id) {
            const cb = document.getElementById(`check-${id}`);
            cb.checked = !cb.checked;
            calc();
        }

        window.resetTool = function () {
            document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
            calc();
        }

        function calc() {
            let score = 0;
            items.forEach(item => {
                if (document.getElementById(`check-${item.id}`).checked) score++;
            });

            const scoreEl = document.getElementById('total-score');
            const resEl = document.getElementById('result-text');

            scoreEl.innerText = score + "/8";

            if (score >= 4) {
                resEl.innerText = "MÊ SẢNG (Delirium)";
                resEl.className = "text-xl font-bold text-red-600 animate-pulse";
            } else if (score >= 1) {
                resEl.innerText = "Nghi ngờ (Subsyndromal)";
                resEl.className = "text-xl font-bold text-amber-500";
            } else {
                resEl.innerText = "Bình thường";
                resEl.className = "text-xl font-bold text-green-600";
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            render();
            // Save history
            const recent = JSON.parse(localStorage.getItem('recentTools')) || [];
            if (!recent.find(x => x.id === 'icdsc')) {
                recent.unshift({ id: 'icdsc', name: 'ICDSC (Mê sảng)', icon: 'fa-brain', color: 'red', url: window.location.href, timestamp: Date.now() });
                localStorage.setItem('recentTools', JSON.stringify(recent.slice(0, 5)));
            }
        });
    </script>
</body>

</html>