<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thang điểm IMPROVE - Nguy cơ chảy máu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="theme-color" content="#4f46e5">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none; touch-action: pan-x pan-y; }
        .result-text, input, textarea { -webkit-user-select: text; user-select: text; }
        @keyframes fadeInUp { from { opacity: 0; transform: translate3d(0, 20px, 0); } to { opacity: 1; transform: translate3d(0, 0, 0); } }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        /* Custom Checkbox Toggle */
        .toggle-checkbox:checked { right: 0; border-color: #4f46e5; }
        .toggle-checkbox:checked + .toggle-label { background-color: #4f46e5; }
        /* Radio Button Style */
        .radio-custom:checked + div { background-color: #eff6ff; border-color: #4f46e5; color: #4f46e5; }
        .radio-custom:checked + div .radio-icon { color: #4f46e5; }
    </style>
</head>
<body>

<!-- DESKTOP HEADER -->
<header class="hidden md:flex fixed top-0 w-full bg-white shadow-sm z-50 h-16 items-center px-8 justify-between">
    <div class="flex items-center gap-3">
        <!-- BẮT BUỘC: Logo lấy từ file cùng thư mục -->
        <img src="logo.png" alt="Logo" class="w-10 h-10 object-contain">
        <h1 class="text-xl md:text-3xl font-bold text-blue-600">Máy Tính Y Học</h1>
    </div>
    <nav class="flex gap-8 text-sm md:text-lg font-medium text-gray-600">
        <a href="index.html" class="hover:text-teal-600 transition">Trang chủ</a>
        <a href="cong-cu.html" class="text-teal-600 font-bold">Công cụ</a>
        <a href="#" onclick="openDrawer(event)" class="hover:text-teal-600 transition">Khác</a>
    </nav>
</header>

<!-- MOBILE HEADER -->
<header class="md:hidden fixed top-0 left-0 right-0 bg-white shadow-sm z-40 h-[60px] flex items-center px-4">
    <a href="cong-cu.html" class="p-2 -ml-2 text-gray-600 hover:text-indigo-600 transition"><i class="fa-solid fa-chevron-left text-lg"></i></a>
    <h1 class="flex-1 text-center text-lg font-bold text-gray-800 truncate px-2">IMPROVE Bleeding Score</h1>
    <div class="w-8"></div>
</header>

<main class="flex-grow container mx-auto px-4 pt-20 md:pt-24 pb-4 max-w-4xl">
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden animate-fade-in-up">
        <!-- Card Header -->
        <div class="hidden md:flex bg-indigo-600 p-6 text-white items-center justify-between">
            <div class="flex items-center">
                <a href="cong-cu.html" class="hidden md:flex w-10 h-10 rounded-full bg-indigo-500 hover:bg-indigo-400 items-center justify-center text-white transition shadow-sm mr-4"><i class="fa-solid fa-chevron-left"></i></a>
                <div><h1 class="text-2xl font-bold">Thang điểm IMPROVE</h1><p class="text-indigo-100 mt-1 text-sm">Đánh giá nguy cơ chảy máu ở bệnh nhân nội khoa</p></div>
            </div>
            <i class="fa-solid fa-user-injured text-4xl text-indigo-300 opacity-50"></i>
        </div>

        <!-- FORM CONTENT -->
        <div class="p-4 md:p-8" id="tool-content">
            
            <!-- Phần 1: Thông tin cơ bản -->
            <div class="mb-6">
                <h3 class="text-sm font-bold text-gray-500 uppercase mb-3 tracking-wide">1. Thông tin bệnh nhân</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Tuổi -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tuổi (năm)</label>
                        <div class="relative">
                            <input type="number" id="age" inputmode="decimal" placeholder="Nhập tuổi" class="w-full p-3 pl-10 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition outline-none text-gray-900 font-semibold">
                            <i class="fa-solid fa-calendar-days absolute left-3.5 top-3.5 text-gray-400"></i>
                        </div>
                    </div>

                    <!-- Giới tính -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Giới tính</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="cursor-pointer relative">
                                <input type="radio" name="gender" value="male" class="radio-custom sr-only">
                                <div class="flex items-center justify-center p-3 border border-gray-200 rounded-xl hover:bg-gray-50 transition h-full text-gray-600">
                                    <i class="fa-solid fa-mars mr-2 radio-icon"></i> Nam
                                </div>
                            </label>
                            <label class="cursor-pointer relative">
                                <input type="radio" name="gender" value="female" class="radio-custom sr-only">
                                <div class="flex items-center justify-center p-3 border border-gray-200 rounded-xl hover:bg-gray-50 transition h-full text-gray-600">
                                    <i class="fa-solid fa-venus mr-2 radio-icon"></i> Nữ
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phần 2: Chỉ số xét nghiệm -->
            <div class="mb-6">
                <h3 class="text-sm font-bold text-gray-500 uppercase mb-3 tracking-wide">2. Chỉ số cận lâm sàng</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- eGFR -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Độ lọc cầu thận (eGFR)</label>
                        <div class="relative">
                            <input type="number" id="gfr" inputmode="decimal" placeholder="mL/min/1.73m²" class="w-full p-3 pl-10 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition outline-none text-gray-900 font-semibold">
                            <i class="fa-solid fa-kidney absolute left-3.5 top-3.5 text-gray-400"></i>
                            <span class="absolute right-3 top-3.5 text-xs text-gray-400">ml/p</span>
                        </div>
                    </div>

                    <!-- Tiểu cầu -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Số lượng tiểu cầu</label>
                        <div class="relative">
                            <input type="number" id="platelets" inputmode="decimal" placeholder="x 10⁹/L" class="w-full p-3 pl-10 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition outline-none text-gray-900 font-semibold">
                            <i class="fa-solid fa-droplet absolute left-3.5 top-3.5 text-gray-400"></i>
                            <span class="absolute right-3 top-3.5 text-xs text-gray-400">G/L</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phần 3: Yếu tố lâm sàng (Checkboxes) -->
            <div class="mb-6">
                <h3 class="text-sm font-bold text-gray-500 uppercase mb-3 tracking-wide">3. Yếu tố lâm sàng</h3>
                <div class="space-y-3">
                    
                    <!-- Ung thư -->
                    <label class="flex items-center justify-between p-3.5 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition group">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-rose-100 flex items-center justify-center text-rose-600 mr-3 group-hover:scale-110 transition">
                                <i class="fa-solid fa-ribbon"></i>
                            </div>
                            <span class="font-medium text-gray-700">Ung thư đang tiến triển</span>
                        </div>
                        <input type="checkbox" id="cancer" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    </label>

                    <!-- Bệnh lý thấp khớp -->
                    <label class="flex items-center justify-between p-3.5 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition group">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 mr-3 group-hover:scale-110 transition">
                                <i class="fa-solid fa-bone"></i>
                            </div>
                            <span class="font-medium text-gray-700">Bệnh lý thấp khớp</span>
                        </div>
                        <input type="checkbox" id="rheumatic" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    </label>

                    <!-- CVC -->
                    <label class="flex items-center justify-between p-3.5 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition group">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-3 group-hover:scale-110 transition">
                                <i class="fa-solid fa-syringe"></i>
                            </div>
                            <span class="font-medium text-gray-700">Đặt Catheter tĩnh mạch trung tâm (CVC)</span>
                        </div>
                        <input type="checkbox" id="cvc" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    </label>

                    <!-- ICU -->
                    <label class="flex items-center justify-between p-3.5 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition group">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600 mr-3 group-hover:scale-110 transition">
                                <i class="fa-solid fa-bed-pulse"></i>
                            </div>
                            <span class="font-medium text-gray-700">Điều trị tại ICU/CCU</span>
                        </div>
                        <input type="checkbox" id="icu" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    </label>

                    <!-- Suy gan -->
                    <label class="flex items-center justify-between p-3.5 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition group">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 mr-3 group-hover:scale-110 transition">
                                <i class="fa-solid fa-flask"></i>
                            </div>
                            <span class="font-medium text-gray-700">Suy gan (INR > 1.5)</span>
                        </div>
                        <input type="checkbox" id="hepatic" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    </label>

                    <!-- Tiền sử chảy máu -->
                    <label class="flex items-center justify-between p-3.5 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition group">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 mr-3 group-hover:scale-110 transition">
                                <i class="fa-solid fa-clock-rotate-left"></i>
                            </div>
                            <div class="flex flex-col">
                                <span class="font-medium text-gray-700">Tiền sử chảy máu</span>
                                <span class="text-xs text-gray-500">Hoặc loét dạ dày trong 3 tháng qua</span>
                            </div>
                        </div>
                        <input type="checkbox" id="bleeding_hist" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    </label>

                    <!-- Loét hoạt động -->
                    <label class="flex items-center justify-between p-3.5 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition group">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 mr-3 group-hover:scale-110 transition">
                                <i class="fa-solid fa-bacteria"></i>
                            </div>
                            <span class="font-medium text-gray-700">Loét dạ dày - tá tràng hoạt động</span>
                        </div>
                        <input type="checkbox" id="active_ulcer" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    </label>

                </div>
            </div>
            
            <!-- [BUTTON GROUP] -->
            <div class="mt-8 grid grid-cols-2 gap-4">
                <button type="button" id="btn-reset" class="flex items-center justify-center py-3 px-4 rounded-xl border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 transition active:scale-95">
                    <i class="fa-solid fa-rotate-right mr-2"></i>Nhập lại
                </button>
                <button type="button" id="btn-calc" class="flex items-center justify-center py-3 px-4 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition active:scale-95">
                    <i class="fa-solid fa-calculator mr-2"></i>Tính điểm
                </button>
            </div>
            
            <!-- [KHU VỰC KẾT QUẢ (Ẩn mặc định)] -->
            <div id="result-area" class="hidden mt-6 animate-fade-in-up">
                <div class="p-5 rounded-xl border-2 mb-4 text-center transition-colors duration-300" id="result-box">
                    <p class="text-gray-500 font-medium uppercase tracking-wider text-xs mb-1">Tổng điểm IMPROVE</p>
                    <div class="text-4xl font-extrabold mb-2" id="score-display">0.0</div>
                    <div class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-white/50 backdrop-blur-sm" id="risk-label">Nguy cơ</div>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <h4 class="font-bold text-blue-800 mb-2 flex items-center"><i class="fa-solid fa-circle-info mr-2"></i>Khuyến nghị</h4>
                    <p class="text-sm text-blue-900 leading-relaxed text-justify">
                        <span id="recommendation-text">...</span>
                    </p>
                </div>
                
                <p class="text-xs text-gray-400 mt-4 text-center italic">
                    Công cụ này hỗ trợ đánh giá nguy cơ chảy máu trên bệnh nhân nội khoa khi cân nhắc dự phòng VTE.
                </p>
            </div>
        </div>
    </div>
</main>

<!-- DRAWER MENU -->
<div id="drawer-overlay" onclick="closeDrawer()" class="fixed inset-0 bg-black/50 z-[60] hidden transition-opacity opacity-0"></div>
<div id="drawer-menu" class="fixed top-0 right-0 h-full w-72 bg-white shadow-2xl z-[70] transform transition-transform translate-x-full duration-300 ease-in-out flex flex-col">
    <div class="p-5 flex justify-between items-center border-b border-gray-100 bg-gray-50"><h2 class="font-bold text-xl text-gray-800">Menu</h2><button onclick="closeDrawer()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 text-gray-500 transition"><i class="fa-solid fa-xmark text-lg"></i></button></div>
    <div class="p-4 flex flex-col gap-2 overflow-y-auto flex-1">
        <a href="gioi-thieu.html" class="flex items-center gap-4 p-3 hover:bg-teal-50 hover:text-teal-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-600 group-hover:scale-110 transition"><i class="fa-solid fa-circle-info"></i></div><span class="font-medium">Giới thiệu</span></a>
        <a href="lien-he.html" class="flex items-center gap-4 p-3 hover:bg-green-50 hover:text-green-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 group-hover:scale-110 transition"><i class="fa-solid fa-envelope"></i></div><span class="font-medium">Liên hệ</span></a>
        <a href="dieu-khoan-dich-vu.html" class="flex items-center gap-4 p-3 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:scale-110 transition"><i class="fa-solid fa-file-contract"></i></div><span class="font-medium">Điều khoản</span></a>
        <a href="chinh-sach-bao-mat.html" class="flex items-center gap-4 p-3 hover:bg-purple-50 hover:text-purple-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 group-hover:scale-110 transition"><i class="fa-solid fa-shield-halved"></i></div><span class="font-medium">Chính sách</span></a>
        <div class="my-2 border-t border-gray-100"></div>
        <a href="ung-ho.html" class="flex items-center gap-4 p-3 hover:bg-rose-50 hover:text-rose-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-rose-100 flex items-center justify-center text-rose-600 group-hover:scale-110 transition"><i class="fa-solid fa-heart"></i></div><span class="font-medium">Ủng hộ</span></a>
    </div>
</div>

<!-- MOBILE NAV -->
<nav class="md:hidden fixed bottom-0 left-0 z-50 w-full h-16 bg-white border-t border-gray-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
    <div class="grid h-full max-w-lg grid-cols-3 mx-auto font-medium">
        <a href="index.html" class="nav-item text-gray-500 inline-flex flex-col items-center justify-center px-5 group hover:text-teal-600"><i class="fa-solid fa-house text-xl mb-1 group-hover:text-teal-600"></i><span class="text-[10px] group-hover:text-teal-600">Trang chủ</span></a>
        <a href="cong-cu.html" class="nav-item active text-teal-600 inline-flex flex-col items-center justify-center px-5 group"><i class="fa-solid fa-calculator text-xl mb-1"></i><span class="text-[10px]">Công cụ</span></a>
        <button type="button" onclick="openDrawer(event)" class="nav-item text-gray-500 inline-flex flex-col items-center justify-center px-5 group hover:text-teal-600"><i class="fa-solid fa-bars text-xl mb-1 group-hover:text-teal-600"></i><span class="text-[10px] group-hover:text-teal-600">Khác</span></button>
    </div>
</nav>

<!-- MODAL -->
<div id="notification-modal" class="fixed inset-0 flex items-center justify-center z-[80] hidden">
    <div class="absolute inset-0 bg-black/50 transition-opacity" onclick="hideModal()"></div>
    <div class="bg-white rounded-xl shadow-xl p-6 relative z-10 w-11/12 max-w-sm text-center transform transition-all scale-100 animate-fade-in-up">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4"><i class="fa-solid fa-triangle-exclamation text-red-600 text-xl"></i></div>
        <h3 class="text-lg font-bold text-gray-900 mb-2">Thông báo</h3>
        <p id="modal-message" class="text-sm text-gray-500 mb-6">...</p>
        <button onclick="hideModal()" class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none transition">Đóng</button>
    </div>
</div>

<script>
// --- 1. TIỆN ÍCH HỆ THỐNG ---
function useTool(id, name, icon, color, url) {
    let recentTools = JSON.parse(localStorage.getItem('recentTools')) || [];
    recentTools = recentTools.filter(tool => tool.id !== id);
    recentTools.unshift({ id, name, icon, color, url, timestamp: new Date().getTime() });
    if (recentTools.length > 5) recentTools.pop();
    localStorage.setItem('recentTools', JSON.stringify(recentTools));
}
function openDrawer(e) { if(e) e.preventDefault(); document.getElementById('drawer-overlay').classList.remove('hidden'); setTimeout(() => document.getElementById('drawer-overlay').classList.remove('opacity-0'), 10); document.getElementById('drawer-menu').classList.remove('translate-x-full'); document.body.style.overflow = 'hidden'; }
function closeDrawer() { const d = document.getElementById('drawer-menu'); const o = document.getElementById('drawer-overlay'); d.classList.add('translate-x-full'); o.classList.add('opacity-0'); setTimeout(() => { o.classList.add('hidden'); document.body.style.overflow = ''; }, 300); }
window.showModal = function(msg) { const m = document.getElementById('notification-modal'); if(m) { document.getElementById('modal-message').textContent = msg; m.classList.remove('hidden'); } };
window.hideModal = function() { const m = document.getElementById('notification-modal'); if(m) m.classList.add('hidden'); };

// --- 2. BẢO MẬT (CHẶN COPY/F12) ---
document.addEventListener('contextmenu', event => event.preventDefault());
document.addEventListener('keydown', function(event) {
    if (event.key === 'F12' || (event.ctrlKey && (['u', 'U', 'c', 'C', 'a', 'A', 's', 'S', 'p', 'P'].includes(event.key)))) {
        event.preventDefault(); return false;
    }
});

// --- 3. LOGIC CÔNG CỤ IMPROVE ---
document.addEventListener('DOMContentLoaded', function() {
    // Save to history on load
    useTool('improve-score', 'Thang điểm IMPROVE', 'fa-user-injured', 'bg-indigo-500', 'thang-diem-improve.html');

    const btnReset = document.getElementById('btn-reset');
    const btnCalc = document.getElementById('btn-calc');
    const resultArea = document.getElementById('result-area');
    const resultBox = document.getElementById('result-box');
    const scoreDisplay = document.getElementById('score-display');
    const riskLabel = document.getElementById('risk-label');
    const recText = document.getElementById('recommendation-text');

    // A. Xử lý nút RESET
    btnReset.addEventListener('click', function() {
        // Reset inputs
        document.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
        document.querySelectorAll('input[type="radio"]').forEach(input => input.checked = false);
        document.querySelectorAll('input[type="checkbox"]').forEach(input => input.checked = false);
        
        // Hide result
        resultArea.classList.add('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // B. Xử lý nút TÍNH ĐIỂM
    btnCalc.addEventListener('click', function() {
        // 1. Get values
        const age = parseFloat(document.getElementById('age').value);
        const gender = document.querySelector('input[name="gender"]:checked')?.value;
        const gfr = parseFloat(document.getElementById('gfr').value);
        const platelets = parseFloat(document.getElementById('platelets').value);

        // 2. Validate
        if (isNaN(age)) { showModal('Vui lòng nhập Tuổi bệnh nhân!'); return; }
        if (!gender) { showModal('Vui lòng chọn Giới tính!'); return; }
        if (isNaN(gfr)) { showModal('Vui lòng nhập độ lọc cầu thận (eGFR)!'); return; }
        if (isNaN(platelets)) { showModal('Vui lòng nhập số lượng tiểu cầu!'); return; }

        // 3. Tính điểm (IMPROVE Score Logic)
        let score = 0;

        // a. Giới tính
        if (gender === 'male') score += 1;

        // b. Tuổi
        if (age >= 40 && age <= 84) score += 1.5;
        else if (age >= 85) score += 3.5;

        // c. Suy thận (eGFR)
        if (gfr >= 30 && gfr < 60) score += 1;
        else if (gfr < 30) score += 2.5;

        // d. Yếu tố khác
        if (document.getElementById('cancer').checked) score += 2;
        if (document.getElementById('rheumatic').checked) score += 2;
        if (document.getElementById('cvc').checked) score += 2;
        if (document.getElementById('icu').checked) score += 2.5;
        if (document.getElementById('hepatic').checked) score += 2.5;
        
        // e. Tiểu cầu
        if (platelets < 50) score += 4; // < 50 x 10^9/L

        if (document.getElementById('bleeding_hist').checked) score += 4;
        if (document.getElementById('active_ulcer').checked) score += 4.5;

        // 4. Hiển thị kết quả
        scoreDisplay.textContent = score.toFixed(1); // Điểm có số lẻ
        
        // Logic phân tầng nguy cơ
        let riskText = "";
        let recommendation = "";
        let bgColorClass = "";
        let textColorClass = "";
        let borderColorClass = "";

        if (score >= 7) {
            riskText = "Nguy cơ chảy máu CAO";
            recommendation = "Bệnh nhân có nguy cơ chảy máu cao. Cân nhắc kỹ lợi ích và nguy cơ khi sử dụng thuốc chống đông dự phòng huyết khối tĩnh mạch (VTE). Nên xem xét các biện pháp dự phòng cơ học (nếu không có chống chỉ định) hoặc giảm liều thuốc chống đông tùy theo tình trạng lâm sàng.";
            bgColorClass = "bg-red-50";
            borderColorClass = "border-red-500";
            textColorClass = "text-red-700";
        } else {
            riskText = "Nguy cơ chảy máu THẤP";
            recommendation = "Bệnh nhân có nguy cơ chảy máu thấp. Có thể xem xét sử dụng thuốc chống đông dự phòng VTE theo phác đồ chuẩn nếu bệnh nhân có nguy cơ huyết khối cao (ví dụ: điểm Padua ≥ 4).";
            bgColorClass = "bg-green-50";
            borderColorClass = "border-green-500";
            textColorClass = "text-green-700";
        }

        // Apply styles
        resultBox.className = `p-5 rounded-xl border-2 mb-4 text-center transition-colors duration-300 ${bgColorClass} ${borderColorClass} ${textColorClass}`;
        riskLabel.textContent = riskText;
        riskLabel.className = `inline-block px-3 py-1 rounded-full text-sm font-bold bg-white/60 backdrop-blur-sm ${textColorClass}`;
        recText.textContent = recommendation;

        resultArea.classList.remove('hidden');
        
        // Scroll to result
        setTimeout(() => {
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
    });
});
</script>
</body>
</html>