<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ - Thang điểm CHA2DS2-VA/VASc</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .active-link {
            background-color: #e0e7ff;
            color: #4f46e5;
            font-weight: 600;
        }
        .score-box {
            background-color: #e0e7ff;
            color: #4f46e5;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .result-text {
            font-size: 1.25rem;
            font-weight: 600;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        /* Fixed header for mobile */
        @media (max-width: 767px) {
            header {
                position: fixed;
                top: 0;
                width: 100%;
                z-index: 1000;
                padding-top: 0.25rem;
                padding-bottom: 0.25rem;
            }
            body {
                padding-top: 60px;
            }
            /* Further reduce padding for navigation links on mobile */
            .nav-link-mobile-padding {
                padding-top: 0.1rem;
                padding-bottom: 0.1rem;
            }
            .mobile-nav-margin-fix {
                margin-top: 0;
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white shadow-md py-4 md:py-4">
        <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0 hidden md:flex">
                <a href="#" class="text-3xl font-bold text-indigo-700 rounded-lg p-2 transition duration-300 hover:text-indigo-900">
                    Máy tính y học
                </a>
            </div>
            <nav class="flex flex-wrap justify-center space-x-1 md:space-x-4 w-full md:w-auto mobile-nav-margin-fix">
                <a href="index.html" class="text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 p-1 rounded-md hover:bg-gray-100 nav-link-mobile-padding">Trang Chủ</a>
                <a href="cong-cu.html" class="text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 p-1 rounded-md hover:bg-gray-100 nav-link-mobile-padding">Công Cụ</a>
                <a href="gioi-thieu.html" class="text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 p-1 rounded-md hover:bg-gray-100 nav-link-mobile-padding">Giới thiệu</a>
                <a href="#lien-he" class="text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 p-1 rounded-md hover:bg-gray-100 nav-link-mobile-padding">Liên Hệ</a>
            </nav>
        </div>
    </header>

    <section class="py-8 md:py-16 bg-white rounded-lg shadow-inner mx-4 my-8 md:mx-auto md:my-12 md:max-w-4xl">
        <div class="container mx-auto px-2 sm:px-4">
            <a href="cong-cu.html" class="block w-max mb-2 bg-indigo-100 p-1 rounded-full text-indigo-700 hover:bg-indigo-200 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </a>
            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8">
                Thang điểm CHA2DS2-VA (ESC 2024)
            </h1>

            <div class="bg-gray-50 p-4 sm:p-6 md:p-8 rounded-xl shadow-lg">
                <form id="chads-vasc-form" class="space-y-6">
                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Chọn loại thang điểm:</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="scoreType" value="CHA2DS2-VA" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500" checked>
                                <span class="ml-2 text-gray-700">CHA₂DS₂-VA (ESC 2024)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="scoreType" value="CHA2DS2-VASc" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">CHA₂DS₂-VASc (Thang điểm cũ)</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">1. Suy tim sung huyết (C)</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="C" value="1" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Có</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="C" value="0" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Không</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">2. Tăng huyết áp (H)</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="H" value="1" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Có</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="H" value="0" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Không</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">3. Tuổi (A)</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="A" value="0" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">&lt; 65 tuổi</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="A" value="1" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">65 - 74 tuổi</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="A" value="2" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">≥ 75 tuổi</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">4. Đái tháo đường (D)</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="D" value="1" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Có</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="D" value="0" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-ring-indigo-500">
                                <span class="ml-2 text-gray-700">Không</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">5. Đột quỵ/TIA/Thuyên tắc huyết khối (S)</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="S" value="2" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Có</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="S" value="0" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Không</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">6. Bệnh mạch máu (V)</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="V" value="1" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Có</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="V" value="0" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Không</span>
                            </label>
                        </div>
                    </div>

                    <div id="sex-input-group" class="input-group hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">7. Giới tính (Sc)</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="Sex" value="0" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Nam</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="Sex" value="1" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <span class="ml-2 text-gray-700">Nữ</span>
                            </label>
                        </div>
                    </div>
                
                    <div class="mt-8 flex flex-col md:flex-row gap-4">
                        <button type="submit" id="calculateBtn" class="flex-1 bg-indigo-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 hover:bg-indigo-700">
                            Tính điểm
                        </button>
                        <button type="button" id="clearBtn" class="flex-1 bg-red-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 hover:bg-red-600">
                            Xóa Dữ Liệu
                        </button>
                    </div>
                </form>

                <div id="result-container" class="mt-8 p-4 sm:p-6 bg-gray-100 border border-gray-200 rounded-xl text-gray-700 leading-relaxed shadow-inner hidden">
                    <h3 class="text-2xl font-bold text-gray-800 text-center mb-6">Kết quả</h3>
                    <div class="flex flex-col md:flex-row justify-center items-center md:space-x-8 space-y-8 md:space-y-0">
                        <div class="w-full md:w-auto flex-1 text-center">
                            <p class="text-lg font-medium text-gray-600 mb-2">Tổng điểm</p>
                            <div id="chads-vasc-score-display" class="score-box">0</div>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <p class="text-lg font-medium text-gray-600 mb-2">Đánh giá và đề xuất</p>
                        <p id="evaluation-text" class="result-text text-indigo-700">Vui lòng chọn các mục trên để tính điểm.</p>
                    </div>
                </div>

                <div id="explanation-container" class="mt-8 p-4 sm:p-6 bg-gray-100 border border-gray-200 rounded-xl text-gray-700 leading-relaxed shadow-inner">
                    </div>
            </div>
        </div>
    </section>

    <footer id="lien-he" class="bg-gray-800 text-white py-8 text-center rounded-t-lg shadow-inner">
        <div class="container mx-auto px-4">
            <p>&copy; 2025 Máy tính y học. Mọi quyền được bảo lưu.</p>
            <p class="mt-2">
                Liên hệ: BS. Nguyễn Duy Toàn - Bệnh viện đa khoa Lâm Đồng
            </p>
            <p>
                Email: <a href="mailto:toannguyen284@gmail.com" class="text-indigo-400 hover:text-white transition duration-300">toannguyen284@gmail.com</a>
            </p>
            <div class="flex justify-center space-x-4 mt-4">
                <a href="chinh-sach-bao-mat.html" class="text-gray-400 hover:text-white transition duration-300">Chính sách bảo mật</a>
                <a href="dieu-khoan-dich-vu.html" class="text-gray-400 hover:text-white transition duration-300">Điều khoản dịch vụ</a>
            </div>
        </div>
    </footer>

    <script>
        const scoreTypeRadios = document.querySelectorAll('input[name="scoreType"]');
        const sexInputGroup = document.getElementById('sex-input-group');
        const explanationContainer = document.getElementById('explanation-container');
        const formTitle = document.querySelector('h1');

        // Hàm cập nhật nội dung giải thích và hiển thị/ẩn giới tính
        function updateUIBasedOnScoreType() {
            const selectedScoreType = document.querySelector('input[name="scoreType"]:checked').value;
            let explanationContent = '';
            let titleText = '';

            if (selectedScoreType === 'CHA2DS2-VA') {
                sexInputGroup.classList.add('hidden');
                titleText = 'Thang điểm CHA2DS2-VA (ESC 2024)';
                explanationContent = `
                    <h4 class="text-lg font-bold text-gray-800 mb-2">Giải thích Thang điểm CHA2DS2-VA (Theo ESC 2024)</h4>
                    <p>Thang điểm CHA2DS2-VA được dùng để đánh giá nguy cơ đột quỵ do thiếu máu cục bộ ở bệnh nhân rung nhĩ không do van tim. Điểm số cao hơn tương ứng với nguy cơ đột quỵ cao hơn và chỉ định điều trị chống đông máu.</p>
                    <p class="mt-2"><strong>Các yếu tố và điểm số:</strong></p>
                    <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                        <li><strong>C</strong>: Suy tim sung huyết (1 điểm)</li>
                        <li><strong>H</strong>: Tăng huyết áp (1 điểm)</li>
                        <li><strong>A2</strong>: Tuổi ≥ 75 tuổi (2 điểm)</li>
                        <li><strong>D</strong>: Đái tháo đường (1 điểm)</li>
                        <li><strong>S2</strong>: Đột quỵ/TIA/Thuyên tắc huyết khối (2 điểm)</li>
                        <li><strong>V</strong>: Bệnh mạch máu (nhồi máu cơ tim trước đây, bệnh động mạch ngoại biên, mảng xơ vữa động mạch chủ) (1 điểm)</li>
                        <li><strong>A</strong>: Tuổi 65-74 tuổi (1 điểm)</li>
                    </ul>
                    <p class="mt-4"><strong>Khuyến cáo điều trị (theo ESC 2024):</strong></p>
                    <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                        <li><strong>0 điểm</strong> &rarr; Nguy cơ thấp. Không cần điều trị chống đông.</li>
                        <li><strong>1 điểm</strong> &rarr; Nguy cơ trung bình. Cân nhắc điều trị chống đông.</li>
                        <li><strong>≥ 2 điểm</strong> &rarr; Nguy cơ cao. Khuyến cáo điều trị chống đông bằng thuốc kháng vitamin K (như Warfarin) hoặc thuốc chống đông đường uống không kháng vitamin K (NOACs).</li>
                        <li><strong>Lưu ý:</strong> Bệnh nhân rung nhĩ kèm <strong>bệnh cơ tim phì đại</strong> hoặc <strong>amyloidosis tim</strong> được khuyến cáo dùng thuốc chống đông bất kể điểm số CHA2DS2-VA.</li>
                    </ul>
                `;
            } else { // CHA2DS2-VASc
                sexInputGroup.classList.remove('hidden');
                titleText = 'Thang điểm CHA2DS2-VASc (Thang điểm cũ)';
                explanationContent = `
                    <h4 class="text-lg font-bold text-gray-800 mb-2">Giải thích Thang điểm CHA2DS2-VASc (Thang điểm cũ)</h4>
                    <p>Thang điểm CHA2DS2-VASc được dùng để đánh giá nguy cơ đột quỵ do thiếu máu cục bộ ở bệnh nhân rung nhĩ không do van tim. Điểm số cao hơn tương ứng với nguy cơ đột quỵ cao hơn và chỉ định điều trị chống đông máu.</p>
                    <p class="mt-2"><strong>Các yếu tố và điểm số:</strong></p>
                    <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                        <li><strong>C</strong>: Suy tim sung huyết (1 điểm)</li>
                        <li><strong>H</strong>: Tăng huyết áp (1 điểm)</li>
                        <li><strong>A2</strong>: Tuổi ≥ 75 tuổi (2 điểm)</li>
                        <li><strong>D</strong>: Đái tháo đường (1 điểm)</li>
                        <li><strong>S2</strong>: Đột quỵ/TIA/Thuyên tắc huyết khối (2 điểm)</li>
                        <li><strong>V</strong>: Bệnh mạch máu (nhồi máu cơ tim trước đây, bệnh động mạch ngoại biên, mảng xơ vữa động mạch chủ) (1 điểm)</li>
                        <li><strong>A</strong>: Tuổi 65-74 tuổi (1 điểm)</li>
                        <li><strong>Sc</strong>: Giới tính nữ (1 điểm)</li>
                    </ul>
                    <p class="mt-4"><strong>Khuyến cáo điều trị (theo thang điểm cũ):</strong></p>
                    <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                        <li><strong>Nam: 0 điểm; Nữ: 1 điểm</strong> &rarr; Nguy cơ thấp. Không cần điều trị chống đông.</li>
                        <li><strong>Nam: 1 điểm; Nữ: 2 điểm</strong> &rarr; Nguy cơ trung bình. Cân nhắc điều trị chống đông.</li>
                        <li><strong>Nam: ≥ 2 điểm; Nữ: ≥ 3 điểm</strong> &rarr; Nguy cơ cao. Khuyến cáo điều trị chống đông bằng thuốc kháng vitamin K (như Warfarin) hoặc thuốc chống đông đường uống không kháng vitamin K (NOACs).</li>
                    </ul>
                `;
            }
            explanationContainer.innerHTML = explanationContent;
            formTitle.textContent = titleText; // Cập nhật tiêu đề form
            clearForm(); // Xóa dữ liệu cũ khi thay đổi loại thang điểm
        }

        // Lắng nghe sự kiện thay đổi radio button scoreType
        scoreTypeRadios.forEach(radio => {
            radio.addEventListener('change', updateUIBasedOnScoreType);
        });

        // Gọi hàm lần đầu để thiết lập UI mặc định
        updateUIBasedOnScoreType();

        document.getElementById('chads-vasc-form').addEventListener('submit', function(event) {
            event.preventDefault();

            let score = 0;
            let allAnswered = true;
            const selectedScoreType = document.querySelector('input[name="scoreType"]:checked').value;

            // Danh sách các nhóm input radio cần kiểm tra
            const radioGroupNames = ['C', 'H', 'A', 'D', 'S', 'V'];
            
            // Nếu là CHA2DS2-VASc, thêm 'Sex' vào danh sách
            if (selectedScoreType === 'CHA2DS2-VASc') {
                radioGroupNames.push('Sex');
            }

            // Kiểm tra và tính điểm
            radioGroupNames.forEach(groupName => {
                const selectedOption = document.querySelector(`input[name="${groupName}"]:checked`);
                if (!selectedOption) {
                    allAnswered = false;
                } else {
                    if (groupName !== 'Sex' || selectedScoreType !== 'CHA2DS2-VASc') {
                        score += parseInt(selectedOption.value);
                    }
                }
            });

            const resultContainer = document.getElementById('result-container');
            const scoreDisplay = document.getElementById('chads-vasc-score-display');
            const evaluationText = document.getElementById('evaluation-text');

            if (!allAnswered) {
                evaluationText.textContent = 'Vui lòng chọn đầy đủ các mục để tính điểm.';
                evaluationText.className = "result-text text-red-500";
                resultContainer.classList.remove('hidden');
                resultContainer.scrollIntoView({ behavior: 'smooth' });
                return;
            }

            let evaluation = "";
            let evaluationClass = "";
            let finalScore = score; // Sử dụng biến tạm để tính điểm cuối cùng

            if (selectedScoreType === 'CHA2DS2-VA') {
                // Đánh giá theo thang CHA2DS2-VA
                if (finalScore === 0) {
                    evaluation = "Nguy cơ thấp. Không cần điều trị chống đông.";
                    evaluationClass = "result-text text-green-700";
                } else if (finalScore === 1) {
                    evaluation = "Nguy cơ trung bình. Cân nhắc điều trị chống đông.";
                    evaluationClass = "result-text text-orange-500";
                } else { // finalScore >= 2
                    evaluation = "Nguy cơ cao. Khuyến cáo điều trị chống đông.";
                    evaluationClass = "result-text text-red-700";
                }
                evaluationText.textContent = `Tổng điểm CHA2DS2-VA: ${finalScore}. ${evaluation}`;
            } else { // CHA2DS2-VASc
                const sex = document.querySelector('input[name="Sex"]:checked').value;
                if (sex === '1') { // Nữ
                    finalScore += 1; // Cộng thêm 1 điểm cho giới tính nữ
                }
                
                // Đánh giá theo thang CHA2DS2-VASc và giới tính
                if (sex === '0') { // Nam
                    if (finalScore === 0) {
                        evaluation = "Nguy cơ thấp. Không cần điều trị chống đông.";
                        evaluationClass = "result-text text-green-700";
                    } else if (finalScore === 1) {
                        evaluation = "Nguy cơ trung bình. Cân nhắc điều trị chống đông.";
                        evaluationClass = "result-text text-orange-500";
                    } else { // finalScore >= 2
                        evaluation = "Nguy cơ cao. Khuyến cáo điều trị chống đông.";
                        evaluationClass = "result-text text-red-700";
                    }
                } else { // Nữ
                    if (finalScore <= 1) {
                        evaluation = "Nguy cơ thấp. Không cần điều trị chống đông.";
                        evaluationClass = "result-text text-green-700";
                    } else if (finalScore === 2) {
                        evaluation = "Nguy cơ trung bình. Cân nhắc điều trị chống đông.";
                        evaluationClass = "result-text text-orange-500";
                    } else { // finalScore >= 3
                        evaluation = "Nguy cơ cao. Khuyến cáo điều trị chống đông.";
                        evaluationClass = "result-text text-red-700";
                    }
                }
                evaluationText.textContent = `Tổng điểm CHA2DS2-VASc: ${finalScore}. ${evaluation}`;
            }
            
            scoreDisplay.textContent = finalScore;
            evaluationText.className = evaluationClass;
            resultContainer.classList.remove('hidden');
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        });

        function clearForm() {
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                // Đảm bảo không xóa lựa chọn thang điểm
                if (radio.name !== 'scoreType') {
                    radio.checked = false;
                }
            });

            document.getElementById('chads-vasc-score-display').textContent = '0';
            document.getElementById('evaluation-text').textContent = 'Vui lòng chọn các mục trên để tính điểm.';
            document.getElementById('evaluation-text').className = "result-text text-indigo-700";
            document.getElementById('result-container').classList.add('hidden');
        }

        document.getElementById('clearBtn').addEventListener('click', clearForm);
    </script>

</body>
</html>
