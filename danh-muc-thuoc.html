<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <!-- Đã thêm user-scalable=no và maximum-scale=1.0 để chặn zoom -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Danh Mục Thuốc & Vật Tư Y Tế</title>
    <!-- Thêm Favicon -->
    <link rel="icon" href="https://raw.githubusercontent.com/maytinhyhoc/trang-chu/main/logo.png" type="image/png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/maytinhyhoc/trang-chu/main/logo.png">
    <link rel="manifest" href="manifest.json">
    <!-- Tải Tailwind CSS từ CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        /* --- NATIVE APP FEEL CSS --- */
        
        /* Ngăn chặn select text toàn trang */
        body {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
            -webkit-touch-callout: none; /* iOS Safari: ngăn menu context khi giữ lâu */
        }

        /* Cho phép select text và thao tác trong ô input/textarea */
        input, textarea {
            -webkit-user-select: text !important;
            user-select: text !important;
        }

        /* Loại bỏ màu highlight mặc định khi tap trên mobile */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        /* Tối ưu thao tác chạm, ngăn delay */
        a, button, input, .cursor-pointer {
            touch-action: manipulation;
        }

        /* --- Styles Global --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            padding-top: 80px; /* Mặc định cho Desktop */
        }
        
        /* Responsive tweaks */
        @media (max-width: 767px) {
            body { 
                padding-top: 0px; /* Header ẩn trên mobile */
                padding-bottom: 80px; /* Chừa chỗ cho Bottom Nav */
            }
        }

        /* Custom style for the active/highlighted navigation link (Desktop) */
        .nav-item-highlight {
            background-color: #eef2ff;
            border-radius: 9999px;
            padding: 4px 12px;
            color: #4f46e5;
            font-weight: 500;
        }

        /* Styles cho Bottom Navigation */
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            color: #6b7280; /* gray-500 */
            transition: color 0.2s;
        }
        .bottom-nav-item.active {
            color: #4f46e5; /* indigo-600 */
        }
        .bottom-nav-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
        }
        .bottom-nav-item span {
            font-size: 10px;
            font-weight: 500;
        }

        /* Sửa lỗi zoom khi bấm vào thanh tìm kiếm trên mobile */
        #tableSearchInput { font-size: 16px !important; }

        /* --- CSS Riêng cho Danh mục thuốc --- */
        .table-container { overflow-x: auto; }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4f46e5;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800 flex flex-col min-h-screen">

    <!-- === DESKTOP HEADER (Ẩn trên Mobile) === -->
    <header class="hidden md:block bg-white shadow-sm py-3 fixed top-0 w-full z-20">
        <div class="container mx-auto px-4 header-content flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center flex-shrink-0 w-auto">
                <a href="index.html" class="logo-text text-3xl font-bold text-indigo-700 rounded-lg transition duration-300 hover:text-indigo-900">
                    Máy tính y học
                </a>
            </div>

            <!-- Navigation Menu -->
            <nav class="nav-menu flex space-x-4">
                <a href="index.html" class="flex-shrink-0 text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 px-3 py-1 rounded-full hover:bg-gray-100">Trang Chủ</a>
                <a href="cong-cu.html" class="flex-shrink-0 text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 nav-item-highlight">Công Cụ</a>
                <a href="gioi-thieu.html" class="flex-shrink-0 text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 px-3 py-1 rounded-full hover:bg-gray-100">Giới thiệu</a>
                <a href="#lien-he" class="flex-shrink-0 text-base font-medium text-gray-700 hover:text-indigo-600 transition duration-300 px-3 py-1 rounded-full hover:bg-gray-100">Liên Hệ</a>
            </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-4 md:py-8">
        
        <!-- Back Button & Title Container -->
        <div class="flex items-center justify-between mb-4 md:mb-6 pt-4 md:pt-0">
            <!-- Nút quay lại (Chỉ hiện Icon) -->
            <a href="cong-cu.html" class="flex-shrink-0 inline-flex items-center justify-center w-10 h-10 bg-white border border-gray-200 rounded-full text-indigo-600 hover:bg-indigo-50 hover:border-indigo-200 transition duration-300 shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </a>

            <!-- Tiêu đề (Căn giữa) -->
            <h1 class="text-xl md:text-3xl font-bold text-center text-gray-800 flex-grow px-2">
                Danh Mục Thuốc & Vật Tư Y Tế
            </h1>

            <!-- Spacer ảo để cân bằng layout (Căn giữa hoàn hảo) -->
            <div class="w-10 h-10 flex-shrink-0"></div>
        </div>

        <!-- Phần Nội dung chính -->
        <div class="mt-2 md:mt-8 bg-white rounded-lg shadow-lg p-3 md:p-8">
            
            <!-- VÙNG TÌM KIẾM CHÍNH -->
            <div class="mb-3 md:mb-6">
                <div class="relative w-full max-w-2xl mx-auto">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-search text-gray-400"></i>
                    </div>
                    <input type="text" id="tableSearchInput" 
                        class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-base shadow-sm transition duration-150 ease-in-out" 
                        placeholder="Nhập mã, tên thuốc hoặc hoạt chất..." 
                        onkeyup="filterTable()">
                </div>
            </div>

            <!-- Controls & Status Container -->
            <div class="flex flex-col md:flex-row gap-2 md:gap-4 mb-3 md:mb-6 items-center justify-between border-b border-gray-100 pb-2 md:pb-4">
                <div class="text-xs md:text-sm text-gray-600 flex items-center gap-2 order-2 md:order-1 w-full md:w-auto">
                    <span class="flex items-center gap-1 bg-gray-50 px-2 md:px-3 py-1 rounded-full border border-gray-200">
                        <span id="connectionStatus" class="w-2 h-2 rounded-full bg-gray-400"></span>
                        <span id="connectionText">Đang kết nối...</span>
                    </span>
                    <span id="resultCount" class="font-medium hidden sm:inline"></span>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="hidden flex-col items-center justify-center py-6 md:py-12">
                <div class="spinner mb-4"></div>
                <p class="text-gray-500 font-medium">Đang tải dữ liệu...</p>
            </div>

            <!-- Search Prompt State -->
            <div id="searchPrompt" class="hidden flex-col items-center justify-center py-6 md:py-12 text-center bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 mx-auto max-w-2xl">
                <div class="bg-indigo-50 rounded-full p-4 md:p-6 mb-3 md:mb-4">
                    <i class="fa-solid fa-magnifying-glass text-indigo-400 text-2xl md:text-4xl"></i>
                </div>
                <h3 class="text-base md:text-lg font-medium text-gray-900">Sẵn sàng tra cứu</h3>
                <p class="text-xs md:text-base text-gray-500 mt-1 max-w-sm px-4">Nhập từ khóa vào ô tìm kiếm ở trên để xem kết quả.</p>
            </div>

            <!-- Table -->
            <div id="tableContainer" class="overflow-hidden rounded-lg border border-gray-200 hidden">
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200" id="medicineTable">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th scope="col" class="px-3 py-3 md:px-6 md:py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider cursor-pointer hover:text-indigo-700 transition-colors whitespace-nowrap" onclick="sortTable(0)">
                                    Mã <i class="fa-solid fa-sort ml-1"></i>
                                </th>
                                <th scope="col" class="px-3 py-3 md:px-6 md:py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider cursor-pointer hover:text-indigo-700 transition-colors" onclick="sortTable(1)">
                                    Tên - Hàm Lượng <i class="fa-solid fa-sort ml-1"></i>
                                </th>
                                <th scope="col" class="px-3 py-3 md:px-6 md:py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider cursor-pointer hover:text-indigo-700 transition-colors" onclick="sortTable(2)">
                                    Hoạt Chất <i class="fa-solid fa-sort ml-1"></i>
                                </th>
                                <th scope="col" class="px-3 py-3 md:px-6 md:py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider whitespace-nowrap">
                                    ĐVT
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="tableBody">
                            <!-- Rows will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Empty/Error State -->
            <div id="emptyState" class="hidden text-center py-6 md:py-12">
                <div class="bg-gray-50 inline-block p-4 md:p-6 rounded-full mb-3 md:mb-4">
                    <i class="fa-solid fa-box-open text-gray-300 text-3xl md:text-5xl"></i>
                </div>
                <p class="text-gray-800 font-medium text-base md:text-lg mb-1" id="errorTitle">Không tìm thấy kết quả</p>
                <p class="text-gray-500 text-xs md:text-sm" id="errorMsg">Thử tìm kiếm với từ khóa khác.</p>
            </div>
            
        </div>
    </main>

    <!-- Footer MỚI (Đã thay thế theo yêu cầu) -->
    <footer id="lien-he" class="bg-gray-800 text-white py-4 md:py-8 text-center rounded-t-lg shadow-inner mt-auto pb-24 md:pb-8">
        <div class="container mx-auto px-4">
            <!-- Dòng bản quyền: Ẩn bớt text thừa trên mobile -->
            <p class="text-xs md:text-base">&copy; 2025 Máy tính y học<span class="hidden md:inline">. Mọi quyền được bảo lưu.</span></p>
            
            <!-- Thông tin liên hệ: Chữ nhỏ hơn, rút gọn nội dung trên mobile -->
            <div class="mt-1 md:mt-2 text-xs md:text-base text-gray-400 md:text-white">
                <!-- Hiện trên Mobile -->
                <p class="md:hidden">BS. Nguyễn Duy Toàn - BVĐK Lâm Đồng</p>
                <!-- Hiện trên Desktop -->
                <p class="hidden md:block">Liên hệ: BS. Nguyễn Duy Toàn - Bệnh viện đa khoa Lâm Đồng</p>
                
                <p class="mt-0.5 md:mt-1">
                    <span class="hidden md:inline">Email: </span><a href="mailto:toannguyen284@gmail.com" class="text-indigo-400 hover:text-white transition duration-300">toannguyen284@gmail.com</a>
                </p>
            </div>

            <!-- Links: Rút gọn tên và thêm dấu gạch phân cách -->
            <div class="flex justify-center space-x-3 md:space-x-4 mt-2 md:mt-4 text-xs md:text-base">
                <a href="chinh-sach-bao-mat.html" class="text-gray-400 hover:text-white transition duration-300">Bảo mật</a>
                <span class="text-gray-600 md:hidden">|</span>
                <a href="dieu-khoan-dich-vu.html" class="text-gray-400 hover:text-white transition duration-300">Điều khoản</a>
            </div>
        </div>
    </footer>

    <!-- MOBILE BOTTOM NAVIGATION -->
    <nav class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 shadow-[0_-2px_10px_rgba(0,0,0,0.1)] z-50 flex justify-around py-2 pb-safe md:hidden">
        <!-- Trang chủ -->
        <a href="index.html" class="bottom-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>
            <span>Trang Chủ</span>
        </a>

        <!-- Công cụ (Active) -->
        <a href="cong-cu.html" class="bottom-nav-item active">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
            </svg>
            <span>Công Cụ</span>
        </a>

        <!-- Giới thiệu -->
        <a href="gioi-thieu.html" class="bottom-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
            </svg>
            <span>Giới thiệu</span>
        </a>

        <!-- Liên hệ -->
        <a href="#lien-he" class="bottom-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
            </svg>
            <span>Liên Hệ</span>
        </a>
    </nav>

    <script>
        // --- JS xử lý Layout (Padding) ---
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('header');
            const body = document.body;

            function adjustBodyPadding() {
                // Nếu header ẩn (mobile) thì padding = 0, ngược lại bằng chiều cao header
                if (header && getComputedStyle(header).display !== 'none') {
                    const headerHeight = header.offsetHeight;
                    body.style.paddingTop = `${headerHeight}px`;
                } else {
                    body.style.paddingTop = '0px';
                }
            }

            adjustBodyPadding();
            window.addEventListener('resize', adjustBodyPadding);
            
            // Khởi động load dữ liệu
            loadGoogleSheetData();
            
            // Focus vào ô tìm kiếm chính
            const tableSearchInput = document.getElementById('tableSearchInput');
            if(tableSearchInput) tableSearchInput.focus();
        });

        // --- JS xử lý Dữ liệu thuốc ---
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTX-zpXLpeS6eKPt668fSZgDNqZSmLZI1BrzUiA9nDE-sUczgZRuJDLkQz4u8f_OAxPfZNOCI37g3d1/pub?output=csv';

        let rawData = [];

        // Elements
        const tableContainer = document.getElementById('tableContainer');
        const tableBody = document.getElementById('tableBody');
        const tableSearchInput = document.getElementById('tableSearchInput');
        const resultCount = document.getElementById('resultCount');
        const emptyState = document.getElementById('emptyState');
        const loadingState = document.getElementById('loadingState');
        const searchPrompt = document.getElementById('searchPrompt'); 
        const errorTitle = document.getElementById('errorTitle');
        const errorMsg = document.getElementById('errorMsg');
        const connectionStatus = document.getElementById('connectionStatus');
        const connectionText = document.getElementById('connectionText');

        async function loadGoogleSheetData() {
            showLoading(true);
            updateStatus('loading');
            
            try {
                const response = await fetch(SHEET_CSV_URL);
                if (!response.ok) throw new Error('Không thể kết nối đến Google Sheets');
                
                const csvText = await response.text();
                processCSV(csvText, 'Google Sheets');
            } catch (error) {
                console.error('Lỗi tải dữ liệu:', error);
                showLoading(false);
                updateStatus('error');
                showError('Không thể tải dữ liệu', 'Vui lòng kiểm tra kết nối mạng.');
            }
        }

        function updateStatus(status) {
            if (status === 'success') {
                connectionStatus.className = 'w-2 h-2 rounded-full bg-green-500 shadow-[0_0_5px_rgba(34,197,94,0.5)]';
                connectionText.innerText = 'Đã kết nối dữ liệu';
                connectionText.className = 'text-green-700 font-medium';
            } else if (status === 'loading') {
                connectionStatus.className = 'w-2 h-2 rounded-full bg-yellow-500 animate-pulse';
                connectionText.innerText = 'Đang đồng bộ...';
                connectionText.className = 'text-yellow-700';
            } else {
                connectionStatus.className = 'w-2 h-2 rounded-full bg-red-500';
                connectionText.innerText = 'Mất kết nối';
                connectionText.className = 'text-red-700';
            }
        }

        function showLoading(isLoading) {
            if (isLoading) {
                loadingState.classList.remove('hidden');
                loadingState.classList.add('flex');
                tableContainer.classList.add('hidden');
                emptyState.classList.add('hidden');
                searchPrompt.classList.add('hidden');
            } else {
                loadingState.classList.add('hidden');
                loadingState.classList.remove('flex');
            }
        }

        function resetToPromptState() {
            tableContainer.classList.add('hidden');
            emptyState.classList.add('hidden');
            searchPrompt.classList.remove('hidden');
            searchPrompt.classList.add('flex');
            resultCount.innerText = `Đã tải ${rawData.length} mục.`;
        }

        function showError(title, msg) {
            tableContainer.classList.add('hidden');
            searchPrompt.classList.add('hidden');
            emptyState.classList.remove('hidden');
            errorTitle.innerText = title;
            errorMsg.innerText = msg;
            resultCount.innerText = 'Thông báo';
        }

        function processCSV(text, sourceName) {
            const lines = text.split('\n');
            const newData = [];
            
            let startIndex = 0;
            for(let i=0; i < Math.min(lines.length, 10); i++) {
                if (lines[i].toLowerCase().includes('mã thuốc')) {
                    startIndex = i + 1;
                    break;
                }
            }

            for (let i = startIndex; i < lines.length; i++) {
                let line = lines[i].trim();
                if (!line) continue;

                const parts = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
                if (parts.length >= 2) {
                    const clean = (str) => str ? str.replace(/^"|"$/g, '').trim() : '';
                    
                    const code = clean(parts[0]);
                    const name = clean(parts[1]);
                    const active = clean(parts[2]);
                    const unit = clean(parts[3]);

                    if (code && name) {
                        newData.push({ code, name, active, unit });
                    }
                }
            }

            if (newData.length > 0) {
                rawData = newData;
                showLoading(false);
                
                if (tableSearchInput.value.trim() !== "") {
                    filterTable();
                } else {
                    resetToPromptState();
                }
                
                updateStatus('success');
            } else {
                showLoading(false);
                showError('Dữ liệu trống', 'Không tìm thấy dòng dữ liệu nào hợp lệ.');
            }
        }

        function renderTable(data) {
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                showError('Không tìm thấy kết quả', `Không tìm thấy thuốc nào khớp với từ khóa "${tableSearchInput.value}"`);
                return;
            } else {
                emptyState.classList.add('hidden');
                searchPrompt.classList.add('hidden');
                tableContainer.classList.remove('hidden');
                resultCount.innerText = `Tìm thấy ${data.length} kết quả`;
            }

            const displayData = data.slice(0, 100);

            displayData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-indigo-50 transition-colors duration-200 group border-b last:border-b-0 border-gray-100';
                
                const activeIngredientHtml = item.active 
                    ? `<span class="px-1 md:px-2 py-0.5 md:py-1 inline-flex text-[10px] md:text-xs leading-4 md:leading-5 font-semibold rounded-full bg-green-100 text-green-800 border border-green-200 whitespace-nowrap">${item.active}</span>`
                    : '<span class="text-gray-300 italic text-[10px] md:text-xs">--</span>';

                row.innerHTML = `
                    <td class="px-3 py-3 md:px-6 md:py-4 whitespace-nowrap text-xs md:text-sm font-bold text-indigo-600 font-mono">
                        ${item.code}
                    </td>
                    <td class="px-3 py-3 md:px-6 md:py-4">
                        <div class="text-xs md:text-sm text-gray-900 font-medium group-hover:text-indigo-900 transition-colors">${item.name}</div>
                    </td>
                    <td class="px-3 py-3 md:px-6 md:py-4">
                        ${activeIngredientHtml}
                    </td>
                    <td class="px-3 py-3 md:px-6 md:py-4 whitespace-nowrap text-xs md:text-sm text-gray-500">
                        ${item.unit}
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            if (data.length > 100) {
                 const row = document.createElement('tr');
                 row.innerHTML = `<td colspan="4" class="px-3 py-3 md:px-6 md:py-4 text-center text-xs text-gray-400 italic bg-gray-50">... và ${data.length - 100} kết quả khác ...</td>`;
                 tableBody.appendChild(row);
            }
        }

        function filterTable() {
            const query = tableSearchInput.value.toLowerCase().trim();
            
            if (!query) {
                resetToPromptState();
                return;
            }

            const filteredData = rawData.filter(item => {
                return (
                    item.code.toLowerCase().includes(query) ||
                    item.name.toLowerCase().includes(query) ||
                    (item.active && item.active.toLowerCase().includes(query))
                );
            });
            
            renderTable(filteredData);
        }

        let sortDirection = 1;
        function sortTable(columnIndex) {
            if (tableContainer.classList.contains('hidden')) return;

            const keys = ['code', 'name', 'active'];
            const key = keys[columnIndex];

            rawData.sort((a, b) => {
                const valA = (a[key] || '').toLowerCase();
                const valB = (b[key] || '').toLowerCase();
                if (valA < valB) return -1 * sortDirection;
                if (valA > valB) return 1 * sortDirection;
                return 0;
            });

            sortDirection *= -1;
            
            const icons = document.querySelectorAll('th i');
            icons.forEach(i => i.className = 'fa-solid fa-sort ml-1 text-gray-300');
            icons[columnIndex].className = sortDirection === 1 
                ? 'fa-solid fa-sort-up ml-1 text-indigo-600' 
                : 'fa-solid fa-sort-down ml-1 text-indigo-600';

            filterTable(); 
        }
    </script>
</body>
</html>