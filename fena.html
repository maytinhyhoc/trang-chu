<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Phân suất thải Natri (FeNa) - Công Cụ Y Học</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="theme-color" content="#4f46e5">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none; touch-action: pan-x pan-y; }
        .result-text, input, textarea { -webkit-user-select: text; user-select: text; }
        @keyframes fadeInUp { from { opacity: 0; transform: translate3d(0, 20px, 0); } to { opacity: 1; transform: translate3d(0, 0, 0); } }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        /* Custom styles for inputs */
        .input-group:focus-within label { color: #4f46e5; }
        .input-group:focus-within i { color: #4f46e5; }
        .input-group:focus-within input { border-color: #4f46e5; background-color: #fff; box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }
        
        /* Select style inside input */
        .unit-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0 center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 1.5rem;
        }
    </style>
</head>
<body>

<!-- DESKTOP HEADER -->
<header class="hidden md:flex fixed top-0 w-full bg-white shadow-sm z-50 h-16 items-center px-8 justify-between">
    <div class="flex items-center gap-3">
        <!-- BẮT BUỘC: Logo lấy từ file cùng thư mục -->
        <img src="logo.png" alt="Logo" class="w-10 h-10 object-contain">
        <h1 class="text-xl md:text-3xl font-bold text-blue-600">Máy Tính Y Học</h1>
    </div>
    <nav class="flex gap-8 text-sm md:text-lg font-medium text-gray-600">
        <a href="index.html" class="hover:text-teal-600 transition">Trang chủ</a>
        <a href="cong-cu.html" class="text-teal-600 font-bold">Công cụ</a>
        <a href="#" onclick="openDrawer(event)" class="hover:text-teal-600 transition">Khác</a>
    </nav>
</header>

<!-- MOBILE HEADER -->
<header class="md:hidden fixed top-0 left-0 right-0 bg-white shadow-sm z-40 h-[60px] flex items-center px-4">
    <a href="cong-cu.html" class="p-2 -ml-2 text-gray-600 hover:text-indigo-600 transition"><i class="fa-solid fa-chevron-left text-lg"></i></a>
    <h1 class="flex-1 text-center text-lg font-bold text-gray-800 truncate px-2">Phân suất thải Natri (FeNa)</h1>
    <div class="w-8"></div>
</header>

<!-- MAIN CONTENT -->
<main class="flex-grow container mx-auto px-4 pt-20 md:pt-24 pb-4 max-w-4xl">
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden animate-fade-in-up">
        <!-- Card Header -->
        <div class="hidden md:flex bg-indigo-600 p-6 text-white items-center justify-between">
            <div class="flex items-center">
                <a href="cong-cu.html" class="hidden md:flex w-10 h-10 rounded-full bg-indigo-500 hover:bg-indigo-400 items-center justify-center text-white transition shadow-sm mr-4"><i class="fa-solid fa-chevron-left"></i></a>
                <div>
                    <h1 class="text-2xl font-bold">Phân suất thải Natri (FeNa)</h1>
                    <p class="text-indigo-100 mt-1 text-sm">Phân biệt suy thận cấp trước thận và hoại tử ống thận cấp</p>
                </div>
            </div>
            <i class="fa-solid fa-flask text-4xl text-indigo-300 opacity-50"></i>
        </div>

        <!-- FORM CONTENT -->
        <div class="p-4 md:p-8" id="tool-content">
            <!-- Alert hướng dẫn -->
            <div class="bg-blue-50 border border-blue-100 rounded-xl p-4 mb-6 flex gap-3 text-sm text-blue-800">
                <i class="fa-solid fa-circle-info mt-0.5"></i>
                <p>Nhập các chỉ số từ xét nghiệm máu và nước tiểu cùng thời điểm để tính toán.</p>
            </div>

            <!-- Group 1: Huyết thanh (Serum) -->
            <div class="mb-6">
                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-droplet text-red-500"></i> Huyết thanh (Serum)
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Natri huyết thanh (P<sub>Na</sub>)</label>
                        <div class="relative">
                            <input type="number" id="p_na" inputmode="decimal" placeholder="VD: 140" class="block w-full pl-3 pr-16 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none transition font-semibold" required>
                            <span class="absolute right-3 top-3 text-gray-400 text-xs font-medium bg-gray-100 px-2 py-1 rounded border border-gray-200">mmol/L</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Creatinine huyết thanh (P<sub>Cr</sub>)</label>
                        <div class="relative">
                            <input type="number" id="p_cr" inputmode="decimal" placeholder="VD: 1.2" step="0.01" class="block w-full pl-3 pr-24 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none transition font-semibold" required>
                            <div class="absolute right-1 top-1 bottom-1 flex items-center bg-gray-100 rounded-lg px-1 border border-gray-200">
                                <select id="p_cr_unit" class="unit-select bg-transparent border-none text-xs font-bold text-gray-600 focus:outline-none cursor-pointer pl-2 h-full">
                                    <option value="mgdl">mg/dL</option>
                                    <option value="umol">µmol/L</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Group 2: Nước tiểu (Urine) -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-flask text-yellow-500"></i> Nước tiểu (Urine)
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Natri niệu (U<sub>Na</sub>)</label>
                        <div class="relative">
                            <input type="number" id="u_na" inputmode="decimal" placeholder="VD: 20" class="block w-full pl-3 pr-16 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none transition font-semibold" required>
                            <span class="absolute right-3 top-3 text-gray-400 text-xs font-medium bg-gray-100 px-2 py-1 rounded border border-gray-200">mmol/L</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Creatinine niệu (U<sub>Cr</sub>)</label>
                        <div class="relative">
                            <input type="number" id="u_cr" inputmode="decimal" placeholder="VD: 100" class="block w-full pl-3 pr-24 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none transition font-semibold" required>
                            <div class="absolute right-1 top-1 bottom-1 flex items-center bg-gray-100 rounded-lg px-1 border border-gray-200">
                                <select id="u_cr_unit" class="unit-select bg-transparent border-none text-xs font-bold text-gray-600 focus:outline-none cursor-pointer pl-2 h-full">
                                    <option value="mgdl">mg/dL</option>
                                    <option value="umol">µmol/L</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- BUTTON GROUP -->
            <div class="mt-8 grid grid-cols-2 gap-4">
                <button type="button" id="btn-reset" class="flex items-center justify-center py-3 px-4 rounded-xl border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 transition active:scale-95">
                    <i class="fa-solid fa-rotate-right mr-2"></i>Nhập lại
                </button>
                <button type="button" id="btn-calc" class="flex items-center justify-center py-3 px-4 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition active:scale-95">
                    <i class="fa-solid fa-calculator mr-2"></i>Tính điểm
                </button>
            </div>
            
            <!-- RESULT AREA -->
            <div id="result-area" class="hidden mt-8 animate-fade-in-up">
                <div class="bg-indigo-50 rounded-2xl border border-indigo-100 overflow-hidden">
                    <div class="bg-indigo-100 px-4 py-2 border-b border-indigo-200 flex justify-between items-center">
                        <span class="text-xs font-bold text-indigo-800 uppercase tracking-wide">Kết quả FeNa</span>
                        <i class="fa-solid fa-chart-pie text-indigo-500"></i>
                    </div>
                    <div class="p-6 text-center">
                        <div class="text-5xl font-extrabold text-indigo-600 mb-1" id="result-value">--%</div>
                        <div class="text-sm text-gray-500 mb-4">Phân suất thải Natri</div>
                        
                        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 inline-block w-full">
                            <div class="font-bold text-lg mb-1" id="result-diagnosis">--</div>
                            <div class="text-sm text-gray-600" id="result-desc">--</div>
                        </div>
                    </div>
                </div>
                
                <!-- Clinical Note -->
                <div class="mt-4 text-xs text-gray-500 italic px-2">
                    * Lưu ý: FeNa < 1% cũng có thể gặp trong viêm cầu thận cấp, thải ghép thận cấp, hoặc tắc nghẽn đường tiểu sớm. Chỉ số có giá trị cao nhất khi bệnh nhân có thiểu niệu.
                </div>
            </div>
        </div>
    </div>
</main>

<!-- DRAWER MENU -->
<div id="drawer-overlay" onclick="closeDrawer()" class="fixed inset-0 bg-black/50 z-[60] hidden transition-opacity opacity-0"></div>
<div id="drawer-menu" class="fixed top-0 right-0 h-full w-72 bg-white shadow-2xl z-[70] transform transition-transform translate-x-full duration-300 ease-in-out flex flex-col">
    <div class="p-5 flex justify-between items-center border-b border-gray-100 bg-gray-50"><h2 class="font-bold text-xl text-gray-800">Menu</h2><button onclick="closeDrawer()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 text-gray-500 transition"><i class="fa-solid fa-xmark text-lg"></i></button></div>
    <div class="p-4 flex flex-col gap-2 overflow-y-auto flex-1">
        <a href="gioi-thieu.html" class="flex items-center gap-4 p-3 hover:bg-teal-50 hover:text-teal-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-600 group-hover:scale-110 transition"><i class="fa-solid fa-circle-info"></i></div><span class="font-medium">Giới thiệu</span></a>
        <a href="lien-he.html" class="flex items-center gap-4 p-3 hover:bg-green-50 hover:text-green-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 group-hover:scale-110 transition"><i class="fa-solid fa-envelope"></i></div><span class="font-medium">Liên hệ</span></a>
        <a href="dieu-khoan-dich-vu.html" class="flex items-center gap-4 p-3 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:scale-110 transition"><i class="fa-solid fa-file-contract"></i></div><span class="font-medium">Điều khoản</span></a>
        <a href="chinh-sach-bao-mat.html" class="flex items-center gap-4 p-3 hover:bg-purple-50 hover:text-purple-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 group-hover:scale-110 transition"><i class="fa-solid fa-shield-halved"></i></div><span class="font-medium">Chính sách</span></a>
        <div class="my-2 border-t border-gray-100"></div>
        <a href="ung-ho.html" class="flex items-center gap-4 p-3 hover:bg-rose-50 hover:text-rose-600 rounded-xl transition group text-gray-700"><div class="w-8 h-8 rounded-full bg-rose-100 flex items-center justify-center text-rose-600 group-hover:scale-110 transition"><i class="fa-solid fa-heart"></i></div><span class="font-medium">Ủng hộ</span></a>
    </div>
</div>

<!-- MOBILE NAV -->
<nav class="md:hidden fixed bottom-0 left-0 z-50 w-full h-16 bg-white border-t border-gray-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
    <div class="grid h-full max-w-lg grid-cols-3 mx-auto font-medium">
        <a href="index.html" class="nav-item text-gray-500 inline-flex flex-col items-center justify-center px-5 group hover:text-teal-600"><i class="fa-solid fa-house text-xl mb-1 group-hover:text-teal-600"></i><span class="text-[10px] group-hover:text-teal-600">Trang chủ</span></a>
        <a href="cong-cu.html" class="nav-item active text-teal-600 inline-flex flex-col items-center justify-center px-5 group"><i class="fa-solid fa-calculator text-xl mb-1"></i><span class="text-[10px]">Công cụ</span></a>
        <button type="button" onclick="openDrawer(event)" class="nav-item text-gray-500 inline-flex flex-col items-center justify-center px-5 group hover:text-teal-600"><i class="fa-solid fa-bars text-xl mb-1 group-hover:text-teal-600"></i><span class="text-[10px] group-hover:text-teal-600">Khác</span></button>
    </div>
</nav>

<!-- MODAL -->
<div id="notification-modal" class="fixed inset-0 flex items-center justify-center z-[80] hidden">
    <div class="absolute inset-0 bg-black/50 transition-opacity" onclick="hideModal()"></div>
    <div class="bg-white rounded-xl shadow-xl p-6 relative z-10 w-11/12 max-w-sm text-center transform transition-all scale-100 animate-fade-in-up">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4"><i class="fa-solid fa-triangle-exclamation text-red-600 text-xl"></i></div>
        <h3 class="text-lg font-bold text-gray-900 mb-2">Thông báo</h3>
        <p id="modal-message" class="text-sm text-gray-500 mb-6">...</p>
        <button onclick="hideModal()" class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none transition">Đóng</button>
    </div>
</div>

<script>
// --- 1. TIỆN ÍCH HỆ THỐNG ---
function useTool(id, name, icon, color, url) {
    let recentTools = JSON.parse(localStorage.getItem('recentTools')) || [];
    recentTools = recentTools.filter(tool => tool.id !== id);
    recentTools.unshift({ id, name, icon, color, url, timestamp: new Date().getTime() });
    if (recentTools.length > 5) recentTools.pop();
    localStorage.setItem('recentTools', JSON.stringify(recentTools));
}
function openDrawer(e) { if(e) e.preventDefault(); document.getElementById('drawer-overlay').classList.remove('hidden'); setTimeout(() => document.getElementById('drawer-overlay').classList.remove('opacity-0'), 10); document.getElementById('drawer-menu').classList.remove('translate-x-full'); document.body.style.overflow = 'hidden'; }
function closeDrawer() { const d = document.getElementById('drawer-menu'); const o = document.getElementById('drawer-overlay'); d.classList.add('translate-x-full'); o.classList.add('opacity-0'); setTimeout(() => { o.classList.add('hidden'); document.body.style.overflow = ''; }, 300); }
window.showModal = function(msg) { const m = document.getElementById('notification-modal'); if(m) { document.getElementById('modal-message').textContent = msg; m.classList.remove('hidden'); } };
window.hideModal = function() { const m = document.getElementById('notification-modal'); if(m) m.classList.add('hidden'); };

// --- 2. BẢO MẬT (CHẶN COPY/F12) ---
document.addEventListener('contextmenu', event => event.preventDefault());
document.addEventListener('keydown', function(event) {
    if (event.key === 'F12' || (event.ctrlKey && (['u', 'U', 'c', 'C', 'a', 'A', 's', 'S', 'p', 'P'].includes(event.key)))) {
        event.preventDefault(); return false;
    }
});

// --- 3. LOGIC CÔNG CỤ (FeNa) ---
document.addEventListener('DOMContentLoaded', function() {
    const btnReset = document.getElementById('btn-reset');
    const btnCalc = document.getElementById('btn-calc');
    const resultArea = document.getElementById('result-area');
    const pCrInput = document.getElementById('p_cr');
    const pCrUnit = document.getElementById('p_cr_unit');
    const uCrInput = document.getElementById('u_cr');
    const uCrUnit = document.getElementById('u_cr_unit');
    
    // Ghi nhận sử dụng tool
    useTool('fena', 'Phân suất thải Natri', 'fa-flask', 'bg-indigo-600', 'fena.html');

    // Focus input đầu tiên
    setTimeout(() => { document.getElementById('p_na').focus(); }, 500);

    // UX: Đồng bộ đơn vị & Cập nhật Placeholder
    function updatePlaceholder(input, unit) {
        if (unit === 'mgdl') input.placeholder = "VD: 1.2";
        else input.placeholder = "VD: 100";
    }

    pCrUnit.addEventListener('change', function() {
        updatePlaceholder(pCrInput, this.value);
        // Tự động đồng bộ unit của U_Cr cho tiện, nhưng user vẫn có thể đổi lại
        if(uCrUnit.value !== this.value) {
            uCrUnit.value = this.value;
            updatePlaceholder(uCrInput, this.value);
        }
    });

    uCrUnit.addEventListener('change', function() {
        updatePlaceholder(uCrInput, this.value);
    });

    // A. Xử lý nút RESET
    btnReset.addEventListener('click', function() {
        if(navigator.vibrate) navigator.vibrate(20);
        
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            input.value = '';
            input.parentElement.parentElement.classList.remove('ring-2', 'ring-red-200'); 
        });
        
        // Reset units về default
        pCrUnit.value = 'mgdl';
        uCrUnit.value = 'mgdl';
        updatePlaceholder(pCrInput, 'mgdl');
        updatePlaceholder(uCrInput, 'mgdl');

        resultArea.classList.add('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // B. Xử lý nút TÍNH ĐIỂM
    btnCalc.addEventListener('click', function() {
        if(navigator.vibrate) navigator.vibrate(20);

        // Lấy giá trị thô
        let pNa = parseFloat(document.getElementById('p_na').value);
        let pCrVal = parseFloat(pCrInput.value);
        let uNa = parseFloat(document.getElementById('u_na').value);
        let uCrVal = parseFloat(uCrInput.value);

        const pCrUnitVal = pCrUnit.value;
        const uCrUnitVal = uCrUnit.value;

        // Validate cơ bản
        if (isNaN(pNa) || isNaN(pCrVal) || isNaN(uNa) || isNaN(uCrVal)) {
             showModal('Vui lòng nhập đầy đủ 4 chỉ số xét nghiệm.');
             return;
        }
        if (pNa <= 0 || pCrVal <= 0 || uCrVal <= 0) { 
             showModal('Các giá trị phải lớn hơn 0 (trừ Na niệu có thể >= 0).');
             return;
        }

        // CHUẨN HÓA ĐƠN VỊ VỀ mg/dL ĐỂ TÍNH TOÁN
        // Hệ số chuyển đổi: umol/L -> mg/dL : chia cho 88.4
        let pCr_normalized = pCrVal;
        if (pCrUnitVal === 'umol') {
            pCr_normalized = pCrVal / 88.4;
        }

        let uCr_normalized = uCrVal;
        if (uCrUnitVal === 'umol') {
            uCr_normalized = uCrVal / 88.4;
        }

        // TÍNH TOÁN
        // Công thức: FeNa = (uNa * pCr) / (pNa * uCr) * 100
        const fena = (uNa * pCr_normalized) / (pNa * uCr_normalized) * 100;
        const fenaFormatted = fena.toFixed(2);

        // HIỂN THỊ KẾT QUẢ
        const resultValueEl = document.getElementById('result-value');
        const resultDiagnosisEl = document.getElementById('result-diagnosis');
        const resultDescEl = document.getElementById('result-desc');

        resultValueEl.textContent = `${fenaFormatted}%`;

        // Logic biện giải
        resultDiagnosisEl.className = "font-bold text-lg mb-1"; 
        
        if (fena < 1) {
            resultDiagnosisEl.textContent = "Suy thận trước thận (Prerenal)";
            resultDiagnosisEl.classList.add("text-green-600");
            resultDescEl.textContent = "Gợi ý nguyên nhân do giảm tưới máu thận (mất nước, suy tim...). Ống thận còn chức năng tái hấp thu Na.";
            resultValueEl.className = "text-5xl font-extrabold text-green-600 mb-1";
        } else if (fena > 2) {
            resultDiagnosisEl.textContent = "Hoại tử ống thận cấp (ATN)";
            resultDiagnosisEl.classList.add("text-red-600");
            resultDescEl.textContent = "Gợi ý tổn thương thực thể tại thận. Ống thận mất khả năng tái hấp thu Na.";
            resultValueEl.className = "text-5xl font-extrabold text-red-600 mb-1";
        } else {
            resultDiagnosisEl.textContent = "Không xác định (Indeterminate)";
            resultDiagnosisEl.classList.add("text-yellow-600");
            resultDescEl.textContent = "Giá trị nằm trong khoảng chồng lấp (1% - 2%). Cần kết hợp lâm sàng và các chỉ số khác.";
            resultValueEl.className = "text-5xl font-extrabold text-yellow-600 mb-1";
        }

        resultArea.classList.remove('hidden');
        
        setTimeout(() => {
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
    });
});
</script>
</body>
</html>